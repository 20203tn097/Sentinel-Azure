jobs:
- job: "ASIMSchemaDataTester"
  displayName: 'Run ASIM testers on "eco-connector-test" workspace'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - checkout: self
    persistCredentials: false
    fetchDepth: 0  # Fetch full repository history
  - task: AzureCLI@2
    inputs:
      azureSubscription: '$(AZURE_SUBSCRIPTION_ID_ASIM)'
      scriptType: 'ps'
      scriptLocation: 'inlineScript'
      inlineScript: |
        set -e  # Exit on error
        echo "Logging in to Azure..."
        az login --service-principal -u $(AZURE_CLIENT_ID_ASIM) -p $(AZURE_CLIENT_SECRET_ASIM) --tenant $(AZURE_TENANT_ID_ASIM)
        if [ $? -ne 0 ]; then
          echo "Azure login failed"
          exit 1
        fi
        echo "Setting subscription..."
        az account set --subscription $(AZURE_SUBSCRIPTION_ID_ASIM)
        if [ $? -ne 0 ]; then
          echo "Setting subscription failed"
          exit 1
        fi
        echo "Login and subscription set successfully"
      addSpnToEnvironment: true  # Add SPN credentials to environment variables for use in subsequent steps 
