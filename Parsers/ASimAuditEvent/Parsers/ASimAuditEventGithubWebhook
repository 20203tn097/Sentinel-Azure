Parser:
  Title: ASIM Audit Event parser for GithubWebhook
  Version: '0.1.0'
  LastUpdated: Apr 05, 2024
Product:
  Name: GithubWebhook
Normalization:
  Schema: AuditEvent
  Version: '0.1'
References:
- Title: ASIM Audit Event Schema
  Link: https://aka.ms/ASimAuditEventDoc
- Title: ASIM
  Link: https:/aka.ms/AboutASIM
- Title: GithubWebhook
  Link: https://docs.github.com/en/webhooks/webhook-events-and-payloads
Description: |
  This ASIM parser supports normalizing the GithubWebhook logs to the ASIM Audit Event normalized schema.
ParserName: ASimAuditEventGithubWebhook
EquivalentBuiltInParser: _ASim_AuditEvent_GithubWebhook
ParserParams:
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
  let parser = (
    disabled:bool = false
  )
  {
    let EventResultDetailslookup=datatable(EventOriginalResultDetails:string,EventResult:string, EventType:string )
     ["check_run","Success","Execute",
      "check_suite","Success", "Set",
      "workflow_run","Success","Execute",
      "workflow_job","Success","Other",
      "push","Success","Install" ,
      "membership","Success","Set",
      "member","Success","Create",
      "ping","Success","Create",
      "branch_protection_rule","Success","Other",
      "code_scanning_alert","Success","Create",
      "create","Success","Create",
      "delete","Success","Delete",
      "deploy_key","Success","Set",
      "deployment","Success","Create",
      "deployment_protection_rule","Success","Other",
      "fork","Success","Other",
      "github_app_authorization","Success","Disable",
      "installation","Success","Install",
      "pull_request","Success","Create"];
     githubscanaudit_CL
     |project 
     EventCount=int(1),
     EventSchema='AuditEvent',
     EventProduct='GithubWebhook',
     EventVendor='Microsoft',
     Dvc='GithubWebhook',
     EventSchemaVersion='0.1',
     EventStartTime=TimeGenerated,
     EventEndTime=TimeGenerated,
     Organization=column_ifexists('organization_s', ""),
     Actor=column_ifexists('pusher_s', ""),
     Type=column_ifexists('SourceSystem',""),
     Operation=column_ifexists('action_s', ""),
     EventOriginalResultDetails=event_s
    |lookup EventResultDetailslookup on EventOriginalResultDetails	
  };
  parser (disabled = disabled)