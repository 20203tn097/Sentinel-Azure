Parser:
  Title: ASIM Audit Event parser for Github
  Version: '0.1.0'
  LastUpdated: Mar 27, 2024
Product:
  Name: Github
Normalization:
  Schema: AuditEvent
  Version: '0.1.0'
References:
- Title: ASIM Audit Event Schema
  Link: https://aka.ms/ASimAuditEventDoc
- Title: ASIM
  Link: https:/aka.ms/AboutASIM
Description: |
  This ASIM parser supports filtering and normalizing Microsoft Github audit events in the GitHubAuditLogPolling_C.
ParserName: ASimAuditEventGithub
EquivalentBuiltInParser: _ASim_AuditEvent_Github
ParserParams:
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
     let parser = (
     disabled:bool = false
     )
     {
     let EventResultDetailslookup=datatable(EventOriginalResultDetails:string,EventResult:string, EventType:string )
     ["user.device_verification_success","Success","Other",
     "user.device_verification_requested","NA","Other",
     "integration_installation.repositories_added","Success","Install",
     "repo.change_merge_setting","Success","Other",
     "repo.set_default_workflow_permissions","Success","Set",
     "repo.set_workflow_permission_can_approve_pr","Success","Set",
     "user.device_verification_success","Success","Other",
     "user.device_verification_requested","NA","Other",
     "user.new_device_used","Success","Other",
     "user.audit_log_export","Success","Other",
     "org.add_member","Success","Create",
     "two_factor_authentication.add_factor","Success","Set",
     "two_factor_authentication.enabled","Success", "Enable",
     "personal_access_token.create","Success","Create",
     "personal_access_token.access_revoked","Success","Disable",
     "personal_access_token.destroy","Success","Delete",
     "personal_access_token.access_granted","Success","Set",
     "repo.create","Success","Create",
     "oauth_authorization.create","Success","Create",
     "oauth_access.create","Success","Create",
     "oauth_access.regenerate","Success","Create",
     "personal_access_token.request_created","Success","Create"];
     GitHubAuditLogPolling_CL  
     |   project 
     TimeGenerated=unixtime_milliseconds_todatetime(created_at_d),
     EventCount=int(1),
     EventSchema='AuditEvent',
     EventProduct='Github',
     EventVendor='Microsoft',
     EventSchemaVersion='0.1',
     EventStartTime=TimeGenerated,
     EventEndTime=TimeGenerated,     
     TargetUsername=column_ifexists('actor_s', ""),
     Operation=column_ifexists('operation_type_s', ""),     
     EventOriginalResultDetails=column_ifexists('action_s', ""),
     EventUid=column_ifexists('_document_id_s', ""),
     |lookup EventResultDetailslookup on EventOriginalResultDetails
     };
     parser (disabled = disabled)