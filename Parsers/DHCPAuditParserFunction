// Title:           DHCP Audit Data Parser
// Author:          Microsoft
// Version:         1.1.0
// Last Updated:    2021-10-28
// Comment:        e
//  
// DESCRIPTION:
// This parser takes raw DHCP Audit logs and parses the data into a normalized schema

// Usage Instruction : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias as DHCP_Audit_CL_ActivityReport.
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. DHCP_Audit_CL_ActivityReport | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
let DHCP_Audit_CL_view = view () {
DHCP_Audit_CL
| extend splitted=parse_csv(RawData)
| mv-expand EventOriginalUid=splitted[0], Date=splitted[1], Time=splitted[2], EventOriginalType=splitted[3] ,SrcIpAddr=splitted[4], SrcHostname=splitted[5], SrcMacAddr=splitted[6], SrcUsername=splitted[7], DhcpSessionId=splitted[8], EventResultDetails=splitted[9], DhcpSrcDHCId=splitted[12], DhcpVendorClass=splitted[13], DhcpVendorClassId=splitted[14], DhcpUserClass=splitted[15], DhcpUserClassId=splitted[16]
| extend 
    EventOriginalResultDetails=EventResultDetails,
    IpAddr=SrcIpAddr,
    Hostname=SrcHostname,
    Username=SrcUsername,
    SessionId=DhcpSessionId
| project TimeGenerated, Time, Date, Computer, _ResourceId, _SubscriptionId, EventOriginalUid, EventOriginalType, SrcIpAddr, IpAddr, SrcHostname, Hostname, SrcMacAddr, SrcUsername, Username, DhcpSessionId, SessionId, EventResultDetails, EventOriginalResultDetails, DhcpSrcDHCId, DhcpVendorClass, DhcpVendorClassId, DhcpUserClass, DhcpUserClassId
};
DHCP_Audit_CL_viewCL
