Parser:
  Title: ASIM Authentication parser for Github
  Version: '0.1.0'
  LastUpdated: Apr 05, 2024
Product:
  Name: Github
Normalization:
  Schema: Authentication
  Version: '0.1.3'
References:
- Title: ASIM Authentication Schema
  Link: https://aka.ms/ASimAuthenticationDoc
- Title: ASIM
  Link: https:/aka.ms/AboutASIM
Description: |
  This ASIM parser supports normalizing the Github logs to the ASIM Authentication normalized schema.
ParserName: ASimAuthenticationGithub
EquivalentBuiltInParser: _ASim_Authentication_Github
ParserParams:
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
     let parser = (
     disabled:bool = false
     )
     { 
     let EventResultDetailslookup=datatable(EventOriginalResultDetails:string,EventResult:string,EventType:string,EventSeverity:string )
     ["user.login","Success","logon","Informational",
     "user.logout","Success","logoff","Informational",
     "user.two_factor_challenge_success","Success","logon","Informational",
     "user.two_factor_challenge_failure","Failure","logon","Informational",
     "user.two_factor_requested","Success","logon","Informational",
     "user.failed_login","Failure","logon","Informational",
     "user.sign_in_from_unrecognized_device_and_location","Success","logon","High",
     "user.sign_in_from_unrecognized_device","NA","logon","High",
     "user.reset_password","Success","logon","Informational",
     "user.device_verification_requested","Success","logon","Informational",
     "user.device_verification_requested","Success","logon","Informational",
     "user.two_factor_recovery_codes_downloaded","Success","logon","Informational",
     "user.forgot_password","Success","logon","Informational",
     "user.new_device_used","Success","logon","Informational",
     "user.promote","Success","Elevate","Informational",
     ];
     let GithubAuthenticationEvent=EventResultDetailslookup 
     |project EventOriginalResultDetails
     | summarize make_set(EventOriginalResultDetails);  
     GitHubAuditLogPolling_CL
     |where operation_type_s == 'authentication'
      and action_s in (GithubAuthenticationEvent)
     |project TimeGenerated=unixtime_milliseconds_todatetime(created_at_d),   
        EventCount=int(1),
        EventProduct = 'Github',
        EventVendor = 'Microsoft',
        EventSchema='Authentication',
        EventSchemaVersion='0.1.3',
        EventUid =_ItemId,
        TargetAppname='Github',
        TargetAppType='SaaS application'
        EventOriginalUid= _document_id_s,
        TargetUsername=actor_s,
        UserId=user_id_d,
        SrcIpAddress=actor_ips_s,
        SrcGeoCountry=actor_location_country_code_s,
        EventStartTime=TimeGenerated,
        EventEndtime=TimeGenerated,
        EventOriginalResultDetails=action_s    
     |lookup EventResultDetailslookup on EventOriginalResultDetails
     };
     parser (disabled = disabled)