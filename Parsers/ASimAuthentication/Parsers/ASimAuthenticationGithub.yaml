Parser:
  Title: ASIM Authentication parser for Github
  Version: '0.1.0'
  LastUpdated: Apr 05, 2024
Product:
  Name: Github
Normalization:
  Schema: Authentication
  Version: '0.1.3'
References:
- Title: ASIM Authentication Schema
  Link: https://aka.ms/ASimAuthenticationDoc
- Title: ASIM
  Link: https:/aka.ms/AboutASIM
Description: |
  This ASIM parser supports normalizing the Github logs to the ASIM Authentication normalized schema.
ParserName: ASimAuthenticationGithub
EquivalentBuiltInParser: _ASim_Authentication_Github
ParserParams:
  - Name: disabled
    Type: bool
    Default: false
ParserQuery: |
     let parser = (
     disabled:bool = false
     )
     { 
     let EventResultDetailslookup=datatable(EventOriginalResultDetails:string,EventResult:string,EventType:string,EventSeverity:string )
     ["user.login","Success","Logon","Informational",
     "user.logout","Success","Logoff","Informational",
     "user.two_factor_challenge_success","Success","Logon","Informational",
     "user.two_factor_challenge_failure","Failure","Logon","Informational",
     "user.two_factor_requested","Success","Logon","Informational",
     "user.failed_login","Failure","Logon","Informational",
     "user.sign_in_from_unrecognized_device_and_location","Success","Logon","High",
     "user.sign_in_from_unrecognized_device","Success","Logon","High",
     "user.two_factor_recovery_codes_downloaded","Success","Logon","Informational",
     "user.new_device_used","Success","Logon","Informational",
     "user.promote","Success","Elevate","Informational",
     ];
     let GithubAuthenticationEvent=EventResultDetailslookup 
     |project EventOriginalResultDetails
     | summarize make_set(EventOriginalResultDetails);  
     GitHubAuditLogPolling_CL
     |where operation_type_s == 'authentication'
      and action_s in (GithubAuthenticationEvent)
     |project TimeGenerated=unixtime_milliseconds_todatetime(created_at_d),   
        EventCount=int(1),
        EventProduct = 'Github',
        EventVendor = 'Microsoft',
        EventSchema='Authentication',
        EventSchemaVersion='0.1.3',
        EventUid =_ItemId,
        TargetAppName='Github',
        TargetAppType='SaaS application',
        EventOriginalUid= _document_id_s,
        TargetUsername=actor_s,
        TargetUsernameType='simple',
        EventStartTime=TimeGenerated,
        EventEndTime=TimeGenerated,
        EventOriginalResultDetails=action_s,
        SrcIpAddr=actor_ip_s,
        SrcGeoCountry=actor_location_country_code_s,
        HttpUserAgent=user_agent_s,
        LogonMethod=user_programmatic_access_name_s,    
        Type    
     |lookup EventResultDetailslookup on EventOriginalResultDetails
     |extend EventResultDetails=iff((EventOriginalResultDetails in("user.two_factor_challenge_failure")),"MFA Not Satisfied","other"),
             EventSubType=iff((EventOriginalResultDetails in ("user.promote")),"AssumeRole ","Remote"),
             DvcAction=EventType,
             IpAddr=SrcIpAddr,
             Application=TargetAppName,
             User=TargetUsername
     };
     parser (disabled = disabled)
