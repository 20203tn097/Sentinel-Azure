--- 
BaseQuery: |-
    let defaultValue = "defaultValue";
    let HostFQDN = strcat('{{Host_HostName}}', '.', '{{Host_DnsDomain}}');
    let hvas = _GetWatchlist('HighValueAssets');
    let GetHighValueAssets =
    hvas
     | where (column_ifexists('Asset Id', defaultValue) != '' and column_ifexists('Asset Id', defaultValue) == '{{Host_AzureID}}') or
     (column_ifexists('Asset FQDN', defaultValue) != '' and column_ifexists('Asset FQDN', defaultValue) == HostFQDN) or
     (column_ifexists('Asset Name', defaultValue) != '' and column_ifexists('Asset Name', defaultValue) == '{{Host_HostName}}') or
     (column_ifexists('Asset Id', defaultValue) != '' and column_ifexists('Asset Id', defaultValue) == '{{Host_OMSAgentID}}')
     | extend ['Watchlist Insight'] = 'Device is tagged as High Value Asset'
     | extend ['Additional Data'] = strcat('Asset Type: ',['Asset Type'],', ','IP Address: ',['IP Address'])
     | project ['Watchlist Insight'],['Additional Data'],Tags;
    GetHighValueAssets   
DataTypes: 
  - 
    DataType: "Watchlist templates"
EntitiesFilter: {}
Insights: 
  DefaultTimeRange: 
    AfterRange: 0d
    BeforeRange: 0d
  Description: |-
      ### Description
       ___ 
      This insight aggregates data from the watchlists templates (High Value Assets) regarding the device.
  DisplayName: "Watchlist Insights (Preview)"
  Id: 3834647e-ac3e-4fb4-a5f8-0dd50ba2b66b
  ReferenceTimeRange: 
    BeforeRange: 0d
  SingleValuesQuery: {}
  TableQuery: 
    ColumnsDefinitions: 
      - 
        Header: "Watchlist Insight"
        OutputType: String
        SupportDeepLink: false
      - 
        Header: "Additional Data"
        OutputType: String
        SupportDeepLink: false
      - 
        Header: Tags
        OutputType: String
        SupportDeepLink: false
    QueriesDefinitions: 
      - 
        Filter: " where 1 == 1"
        Project: " project ['Watchlist Insight'], ['Additional Data'], Tags"
        Summarize: " summarize count() by ['Watchlist Insight'], ['Additional Data'], Tags"
Provider: Sentinel
RequiredInputFieldsSets: 
  - - Host_HostName
    - Host_DnsDomain
  - - Host_AzureID
  - - Host_OMSAgentID
SchemaVersion: "1.0"
Type: KQL
