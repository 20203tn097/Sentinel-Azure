{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "InspiraEnterprise",
    "comments": "Solution template for Syslog_Bifurcation"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Syslog Bifurcation",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "Syslog_Bifurcation",
    "_solutionVersion": "3.0.0",
    "solutionId": "azuresentinel.azure-sentinel-solution-syslog-bifurcation",
    "_solutionId": "[variables('solutionId')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "Syslog_Bifurcation",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Syslog-Bifurcation Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "The Data Ingestion Comparison Hourly workbook offers a comprehensive view of ingested data, presenting the total data volume and ingestion amounts in GB, categorized by each hour. This breakdown helps in monitoring and comparing data ingestion trends over time, ensuring visibility into hourly ingestion patterns and potential anomalies."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Data Ingestion Comparison Hourly\\n---\\n\"},\"name\":\"text - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where TimeGenerated > ago(1d)\\r\\n| summarize Size = sum(_BilledSize)\\r\\n| extend GB = Size/1073741824\",\"size\":4,\"title\":\"Syslog - 24Hr\",\"noDataMessage\":\"No Datra found\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000}},\"customWidth\":\"28\",\"name\":\"query - 11\",\"styleSettings\":{\"maxWidth\":\"28\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"Syslog Last log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":1}},\"customWidth\":\"34\",\"name\":\"query - 15\",\"styleSettings\":{\"maxWidth\":\"34\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| extend Day = bin(TimeGenerated,1d)\\r\\n| extend Quantity = _BilledSize\\r\\n| project Day,Quantity,TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| summarize EventCount = sum(Quantity) by Day\\r\\n| extend GB = EventCount/1073741824\\r\\n\",\"size\":0,\"title\":\"Daily Ingestion - Syslog\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"sortBy\":[{\"itemKey\":\"Day\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Day\",\"sortOrder\":2}]},\"customWidth\":\"38\",\"name\":\"query - 23\",\"styleSettings\":{\"maxWidth\":\"38\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where TimeGenerated > ago(30d)\\r\\n| extend Day = bin(TimeGenerated,1d)\\r\\n| extend Quantity = _BilledSize\\r\\n| project Day,Quantity,TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| summarize IngestionVolume_bytes= sum(Quantity) by Day, Computer\\r\\n| extend GB = IngestionVolume_bytes/1073741824\\r\\n| sort by Day desc\",\"size\":2,\"title\":\"Daily Ingestion - Syslog on the basis of Computer\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"rowLimit\":10000}},\"customWidth\":\"60\",\"name\":\"query - 23\",\"styleSettings\":{\"maxWidth\":\"60\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AZ1 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ1\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AZ2 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ2\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AZ3 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ3\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet DHCP = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"DHCP_CL\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet DHCP1 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"DHCP_CL\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD1 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD2 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD3 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD4 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD5 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD6 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD7 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD8 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD9 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD10 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AD11 = Syslog | where Computer in  (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"Active Directory\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet CisASA = Syslog | where Computer == \\\"{Computername}\\\" | project TimeGenerated,Computer,SourceName = \\\"Cisco ASA\\\" | sort by TimeGenerated desc | take 1;\\r\\nunion AZ1,AZ2,AZ3,DHCP,DHCP1,AD,AD1,AD2,AD3,AD4,AD5,AD5,AD6,AD7,AD7,AD8,AD9,AD10,AD11,CisASA\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| sort by SourceName asc\\r\\n\\r\\n\",\"size\":2,\"title\":\"Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"query - 22\",\"styleSettings\":{\"maxWidth\":\"40\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer in (\\\"{Computername}\\\")\\r\\n//| where Computer !=  \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(1d)\\r\\n| summarize Size = sum(_BilledSize)\\r\\n| extend GB = Size/1073741824\",\"size\":1,\"title\":\"Palo Alto for 24 Hours\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"blueLight\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"EventCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"29\",\"name\":\"query - 4\",\"styleSettings\":{\"maxWidth\":\"29\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| where Computer in  (\\\"{Computername}\\\",\\\"{Computername}\\\")\\r\\n| extend Day = bin(TimeGenerated,1d)\\r\\n| extend Quantity = _BilledSize\\r\\n| project Day,Quantity,TimeGenerated,Computer\\r\\n| summarize EventCount= sum(Quantity) by Day\\r\\n| extend GB = EventCount/1073741824\\r\\n| sort by Day\",\"size\":1,\"title\":\"Daily Ingestion - Palo Alto\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"sortBy\":[{\"itemKey\":\"Day\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Day\",\"sortOrder\":2}]},\"customWidth\":\"36\",\"name\":\"query - 13\",\"styleSettings\":{\"maxWidth\":\"36\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AZ1 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ1\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AZ2 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ2\\\" | sort by TimeGenerated desc | take 1;\\r\\nlet AZ3 = Syslog | where Computer in (\\\"{Computername}\\\") | project TimeGenerated,Computer,SourceName = \\\"PA-VM-AZ3\\\" | sort by TimeGenerated desc | take 1;\\r\\nunion AZ1,AZ2,AZ3\\r\\n| where TimeGenerated >= ago(30d)\",\"size\":1,\"title\":\"Palo Alto\",\"noDataMessage\":\"No datra found for 2 days\",\"noDataMessageStyle\":3,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Computer\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Computer\",\"sortOrder\":1}]},\"customWidth\":\"34\",\"name\":\"query - 14\",\"styleSettings\":{\"maxWidth\":\"34\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let AZ1 = Syslog | where Computer == \\\"{Computername}\\\" | where TimeGenerated >= ago(30d) | extend Day = bin(TimeGenerated,1d) | extend Quantity = _BilledSize |project Day,Quantity,TimeGenerated,Computer | summarize IngestionVolume_bytes= sum(Quantity) by Day | extend GB = IngestionVolume_bytes/1073741824 | extend SourceName = \\\"PA-VM-AZ1\\\"  | sort by Day desc;\\r\\nlet AZ2 = Syslog | where Computer == \\\"{Computername}\\\" | where TimeGenerated >= ago(30d) | extend Day = bin(TimeGenerated,1d) | extend Quantity = _BilledSize |project Day,Quantity,TimeGenerated,Computer | summarize IngestionVolume_bytes= sum(Quantity) by Day | extend GB = IngestionVolume_bytes/1073741824 | extend SourceName = \\\"PA-VM-AZ2\\\"  | sort by Day desc;\\r\\nlet AZ3 = Syslog | where Computer == \\\"{Computername}\\\" | where TimeGenerated >= ago(30d) | extend Day = bin(TimeGenerated,1d) | extend Quantity = _BilledSize |project Day,Quantity,TimeGenerated,Computer | summarize IngestionVolume_bytes= sum(Quantity) by Day | extend GB = IngestionVolume_bytes/1073741824 | extend SourceName = \\\"PA-VM-AZ3\\\" | sort by Day desc;\\r\\nunion AZ1,AZ2,AZ3\\r\\n| sort by Day desc \",\"size\":0,\"title\":\"Daily Ingestion Volume of Palo Alto - Segregated on the basis of machine\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"SourceName\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"PA-VM-AZ1\",\"representation\":\"gray\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"PA-VM-AZ2\",\"representation\":\"grayBlue\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"PA-VM-AZ3\",\"representation\":\"turquoise\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blueLight\",\"text\":\"{0}{1}\"}]}}],\"sortBy\":[{\"itemKey\":\"$gen_heatmap_GB_2\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_heatmap_GB_2\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 24\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\",\"size\":1,\"title\":\"PA-VM-AZ1\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"brown\"}},{\"columnMatch\":\"Size_GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 8\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"PA-VM-AZ1 - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"query - 16\",\"styleSettings\":{\"maxWidth\":\"35\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n|where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\",\"size\":1,\"title\":\"PA-VM-AZ2\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"yellow\"}},{\"columnMatch\":\"Size_GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 10\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n|where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"PA-VM-AZ2 - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"query - 17\",\"styleSettings\":{\"maxWidth\":\"35\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\",\"size\":1,\"title\":\"\\t PA-VM-AZ3\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"magenta\"}},{\"columnMatch\":\"Size_GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}}]}},\"customWidth\":\"50\",\"name\":\"query - 9\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated > ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"PA-VM-AZ3 - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"query - 18\",\"styleSettings\":{\"maxWidth\":\"35\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where HostName in (\\\"{Computername}\\\" , \\\"{Computername}\\\")\\r\\n| where TimeGenerated > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\",\"size\":1,\"title\":\"DHCP\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"GB\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 5\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where HostName in (\\\"{Computername}\\\" , \\\"{Computername}\\\")\\r\\n| where TimeGenerated > ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"DHCP - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"query - 19\",\"styleSettings\":{\"maxWidth\":\"35\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer in  (\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\")\\r\\n| where TimeGenerated > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\",\"size\":1,\"title\":\"Active Directory\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 6\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer in  (\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\",\\\"{Computername}\\\")\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| project TimeGenerated,Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"Active Directory - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"38\",\"name\":\"query - 20\",\"styleSettings\":{\"maxWidth\":\"38\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where EventTime > ago(30d)\\r\\n| summarize Size = sum(_BilledSize),EventCount = count() by bin(TimeGenerated, 1d)\\r\\n| extend GB = Size/1073741824\\r\\n| project TimeGenerated,GB,EventCount\\r\\n\",\"size\":0,\"title\":\"CiscoASA\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"red\"}}],\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query - 7\",\"styleSettings\":{\"maxWidth\":\"50\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\r\\n| where Computer == \\\"{Computername}\\\"\\r\\n| where TimeGenerated >= ago(30d)\\r\\n| project TimeGenerated, Computer\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":4,\"title\":\"CiscoASA - Last Log Received\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"query - 21\",\"styleSettings\":{\"maxWidth\":\"35\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"union *\\r\\n| project TimeGenerated, TableName = Type\\r\\n| summarize by TableName\\r\\n| sort by TableName asc\\r\\n//| where TableName contains \\\"AuditLogs\\\"\\r\\n//| sort by TimeGenerated desc\\r\\n//| take 1\",\"size\":0,\"showRefreshButton\":true,\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"TableName\",\"parameterName\":\"TableName\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 25\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let TableName_ = dynamic({TableName});\\r\\nunion *\\r\\n| project TimeGenerated, TableName = Type\\r\\n| where TableName in (TableName_)\\r\\n| sort by TimeGenerated desc\\r\\n| take 1\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 26\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//let TableName = \\\"OfficeActivity,Heartbeat,SentinelHealth,AADServicePrincipalSignLogs,SecurityAlert,SecurityIncident,Usage\\\"\\r\\nlet TableName_ = dynamic({TableName});\\r\\nunion withsource=_TableName *\\r\\n| where TimeGenerated > ago(24h)  // Change the time range to 6 hours\\r\\n//| extend Hour = bin(TimeGenerated, 1h)  // Bin the time into hours\\r\\n| summarize\\r\\n    Entries = count(),\\r\\n    Size = sum(_BilledSize),\\r\\n    last_log = datetime_diff(\\\"second\\\", now(), max(TimeGenerated)),\\r\\n    estimate  = sumif(_BilledSize, _IsBillable == true)\\r\\n    by _TableName, _IsBillable,TimeGenerated\\r\\n| project\\r\\n    TimeGenerated,\\r\\n    //['Hour'] = Hour,\\r\\n    ['TableName'] = _TableName,\\r\\n    ['Table Size'] = Size,\\r\\n    ['Table Entries'] = Entries,\\r\\n    ['Size per Entry'] = 1.0 * Size / Entries,\\r\\n    ['IsBillable'] = _IsBillable\\r\\n| order by TimeGenerated, ['Table Size'] desc,['TableName']\\r\\n| sort by TimeGenerated desc \\r\\n| project TimeGenerated,['TableName'] \\r\\n| where ['TableName'] contains TableName_\\r\\n| summarize by ['TableName'], TimeGenerated\\r\\n\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"customWidth\":\"30\",\"name\":\"query - 3\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let TableName_ = dynamic({TableName});\\r\\nunion withsource=_TableName *\\r\\n| where TimeGenerated > ago(30d)  // Change the time range to 6 hours\\r\\n| extend DateTime = bin(TimeGenerated, 1h)  // Bin the time into hours\\r\\n| summarize\\r\\n    Entries = count(),\\r\\n    Size = sum(_BilledSize),\\r\\n    last_log = datetime_diff(\\\"second\\\", now(), max(TimeGenerated)),\\r\\n    estimate  = sumif(_BilledSize, _IsBillable == true)\\r\\n    by DateTime, _TableName, _IsBillable\\r\\n| project\\r\\n    ['DateTime'] = DateTime,\\r\\n    ['Table Name'] = _TableName,\\r\\n    ['Table Size'] = Size,\\r\\n    ['Table Entries'] = Entries,\\r\\n    ['Size per Entry'] = 1.0 * Size / Entries,\\r\\n    ['IsBillable'] = _IsBillable\\r\\n| order by DateTime , ['Table Size'] desc\\r\\n| where ['Table Name'] contains tostring(TableName_)\\r\\n| extend PreviousSize = prev(['Table Size'],1)\\r\\n| extend SizeChange = ['Table Size'] - PreviousSize\\r\\n| project PreviousSize, ['Table Name'], DateTime, TableSize = SizeChange\\r\\n| project-away PreviousSize\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"30\",\"name\":\"query - 2\",\"styleSettings\":{\"maxWidth\":\"30\"}}],\"fallbackResourceIds\":[\"\"],\"fromTemplateId\":\"sentinel-syslog-bifurcation\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=Syslog_Bifurcation; logoFileName=Azure_Sentinel.svg; description=The Data Ingestion Comparison Hourly workbook offers a comprehensive view of ingested data, presenting the total data volume and ingestion amounts in GB, categorized by each hour. This breakdown helps in monitoring and comparing data ingestion trends over time, ensuring visibility into hourly ingestion patterns and potential anomalies.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Syslog Bifurcation; templateRelativePath=Syslog-Bifurcation.json; subtitle=; provider=InspiraEnterprise; author=}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Syslog_Bifurcation",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "InspiraEnterprise"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Syslog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SecurityEvents",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "AzureActivity",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Syslog via AMA",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "Windows Security Events via AMA",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "Azure Activity",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Syslog_Bifurcation",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Syslog_Bifurcation/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The Data Ingestion Comparison Hourly workbook offers a comprehensive view of ingested data, presenting the total data volume and ingestion amounts in GB, categorized by each hour. This breakdown helps in monitoring and comparing data ingestion trends over time, ensuring visibility into hourly ingestion patterns and potential anomalies.</p>\n<p><strong>Workbooks:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "https://raw.githubusercontent.com/Azure/Azure-Sentinel/refs/heads/master/Logos/Azure_Sentinel.svg",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Syslog_Bifurcation",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "InspiraEnterprise"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2024-09-20",
        "lastPublishDate": "2024-09-20",
        "providers": [
          "Microsoft"
        ],
        "categories": {
          "domains": [
            "Security - Cloud Security"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
