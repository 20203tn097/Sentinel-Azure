{
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2022-09-01-preview",
    "name": "OnePasswordSignIn",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "OnePasswordSignIn",
            "title": "1Password SignIn Events",
            "publisher": "Masero",
            "descriptionMarkdown": "The 1Password Sigin Events connector allows the user to ingest 1Password Sigin events into Microsoft Sentinel.",
            "graphQueriesTableName": "OnePasswordSignInEvents_CL",
            "graphQueries": [
                {
                    "metricName": "Total data received",
                    "legend": "OnePasswordSignInEvents",
                    "baseQuery": "{{graphQueriesTableName}}"
                }
            ],
            "sampleQueries": [
                {
                    "description" : "Top 10 something",
                    "query": "{{graphQueriesTableName}}\n |  summarize count() by action_s\n | top 10 by count_"
                }
            ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                }
            ],
            "connectivityCriterias": [
                {
                    "type": "SentinelKindsV2",
                    "value": [
                        "APIPolling"
                    ]
                }
            ],
            "availability": {
                "isPreview": false
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "write": true,
                            "read": true,
                            "delete": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "1Password API token",
                        "description": "A 1Password API Token is required. See the [1Password documentation](https://support.1password.com/events-reporting/#appendix-issue-or-revoke-bearer-tokens) on how to create an API token."
                    }
                ]
            },
            "instructionSteps": [
                {
                    "title": "",
                    "description": "**STEP 1 - Create a 1Password API token** \n\n Follow the [1Password documentation](https://support.1password.com/events-reporting/#appendix-issue-or-revoke-bearer-tokens) for guidance on this step." 
                },
                {
                    "title": "",
                    "description": "**STEP 2 - Choose the correct base URL** \n\n There are multiple 1Password servers which might host your events. The correct server depends on your license and region. Follow the [1Password documentation](https://developer.1password.com/docs/events-api/reference/#servers) to choose the correct server. Input the base URL as displayed by the documentation (including 'https://' and without a trailing '/')." 
                },
                {
                    "title": "",
                    "description": "**STEP 3 - Enter your 1Password Details** \n\n Enter the 1Password base URL & API Token below:",
                    "instructions":[
                        {
                            "parameters": {
                                "enable": "true",
                                "userRequestPlaceHoldersInput": [
                                    {
                                        "displayText": "1Password Base URL",
                                        "requestObjectKey": "apiEndpoint",
                                        "placeHolderName": "{{BaseUr}}",
                                        "placeHolderValue": ""
                                    }
                                ]
                            },
                            "type": "APIKey"
                        }
                    ]
                }
            ]
        }
    }
}