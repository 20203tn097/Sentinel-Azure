{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "logAnalyticsWorkspaceName": {
            "type": "string",
            "metadata": {
                "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
            }
        },
        "connectorResourceName": {
            "type": "string",
            "defaultValue": "[newGuid()]",
            "metadata": {
                "description": "Resource name for connector"
            }
        }
    },
    "functions": [],
    "variables": {},
    "resources": [{
        "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
        "name": "[concat(parameters('logAnalyticsWorkspaceName'),'/Microsoft.SecurityInsights/', parameters('connectorResourceName'))]",
        "apiVersion": "2021-03-01-preview",
        "location": "[resourceGroup().location]",
        "dependsOn": [],
        "kind": "APIPolling",
        "properties": {
            "connectorUiConfig": {
                "id": "CohesitySecurityAlerts",
                "title": "Cohesity Security Alerts",
                "publisher": "Cohesity",
                "descriptionMarkdown": "The [Cohesity](https://helios.cohesity.com) Security Alerts provides the capability to ingest [Cohesity System Health Alerts](https://helios.cohesity.com/health/alerts) alerts into Microsoft Sentinel through the REST API. This data connector uses Microsoft Sentinel native polling capability.",
                "graphQueriesTableName": "HeliosAuditNativePoller_CL",
                "graphQueries": [{
                    "metricName": "Total data received",
                    "legend": "Cohesity Security Alerts",
                    "baseQuery": "{{graphQueriesTableName}}"
                }],
                "sampleQueries": [{
                    "description": "All Cohesity Security Alerts",
                    "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
                }],
                "dataTypes": [{
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                }],
                "connectivityCriteria": [{
                    "type": "SentinelKindsV2",
                    "value": []
                }],
                "availability": {
                    "status": 1,
                    "isPreview": true
                },
                "permissions": {
                    "resourceProvider": [{
                            "provider": "Microsoft.OperationalInsights/workspaces",
                            "permissionsDisplayText": "read and write permissions are required.",
                            "providerDisplayName": "Workspace",
                            "scope": "Workspace",
                            "requiredPermissions": {
                                "write": true,
                                "read": true,
                                "delete": true
                            }
                        },
                        {
                            "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                            "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                            "providerDisplayName": "Keys",
                            "scope": "Workspace",
                            "requiredPermissions": {
                                "action": true
                            }
                        }
                    ],
                    "customs": [{
                        "name": "Cohesity Security Alerts API credentials",
                        "description": "**HeliosAPIBearerToken** is required for REST API. [See the documentation to learn more about API](https://api.helios.com/web#authentication). Check all [requirements and follow the instructions](https://api.Cohesity.com/web#authentication) for obtaining credentials."
                    }]
                },
                "instructionSteps": [{
                    "title": "Connect Cohesity Security Alerts to Microsoft Sentinel",
                    "description": "Enable Cohesity Security Alerts Logs.",
                    "instructions": [{
                        "parameters": {
                            "enable": "true"
                        },
                        "type": "APIKey"
                    }]
                }]
            },
            "pollingConfig": {
                "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "apiKey"
                },
                "request": {
                    "apiEndpoint": "https://cohesityalerthttptrigger.azurewebsites.net/api/func-cohesity_duplicate_alerts_filter-prod-002?code=m5xUh866Mqo7SWyYITekK2tMarpE4yKz9fYnh5_7Gj1TAzFuoQ8T-Q==",
                    "httpMethod": "Get"
                },
                "paging": {
                    "pagingType": "PageToken",
                    "nextPageParaName": "cursor",
                    "nextPageTokenJsonPath": "..response_metadata.next_cursor"
                },
                "response": {
                    "eventsJsonPaths": [
                        "$"
                    ]
                }
            }
        }
    }],
    "outputs": {}
}
