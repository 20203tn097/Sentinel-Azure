{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 312.82 53.38\">\n    <g>\n        <g>\n            <g>\n                <g>\n                    <g>\n                        <path class=\"cls-3\"\n                              d=\"M0,53.38V15.7H37q11.57,0,11.56,11.56V53.38H38.67V26.55a2,2,0,0,0-2.28-2.29h-7.2V53.38H19.34V24.26H9.85V53.38Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\" d=\"M55.61,0H65.75V9.56H55.61Zm.15,15.7H65.6V53.38H55.76Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M74.09,53.38V15.7h37q11.57,0,11.56,11.56V53.38h-9.85V26.55a2,2,0,0,0-2.28-2.29h-7.2V53.38H93.43V24.26H83.94V53.38Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M129.91,41.82V27.26q0-11.57,11.56-11.56h9.27q11.56,0,11.56,11.56v11H139.75v4.28A2,2,0,0,0,142,44.82H162.3v8.56H141.47q-11.57,0-11.56-11.56m9.84-11.28h12.71v-4a2,2,0,0,0-2.29-2.29H142a2,2,0,0,0-2.29,2.29Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M169.32,41.82V27.26q0-11.57,11.57-11.56h17.55v8.56h-17a2,2,0,0,0-2.29,2.29v16a2,2,0,0,0,2.29,2.29h17v8.56H180.89q-11.56,0-11.57-11.56\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M216.06,53.38Q204.5,53.38,204.5,42t11.56-11.34h9.85V26.55a2,2,0,0,0-2.29-2.29H206.46V15.7h17.73q11.56,0,11.57,11.56V53.38Zm-1.71-10.85a2,2,0,0,0,2.28,2.29h9.28V38.39h-9.28a2,2,0,0,0-2.28,2.29Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M243.13,50.17V44.82h16.41c1.62,0,2.43-.91,2.43-2.71s-.72-2.91-2.14-3.15l-7.71-1.28q-9-1.5-9-10.42,0-11.57,11.56-11.56H270v8.56h-14.7c-1.62,0-2.43.91-2.43,2.72s.72,2.9,2.14,3.14l7.71,1.28q9,1.5,9,10.42,0,11.57-11.56,11.56H243.13Z\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M278,41.82V4.14h9.85V15.7h12.28v8.56H287.89V42.53a2,2,0,0,0,2.29,2.29h10.7v8.56H289.61Q278,53.38,278,41.82\"\n                              transform=\"translate(0 0)\"/>\n                        <path class=\"cls-3\"\n                              d=\"M307.43,19.46H307V16h-1.18v-.42h2.84V16h-1.19Zm3.27,0-1.21-3.31h0l0,1.09v2.22H309V15.54h.68l1.2,3.3,1.22-3.3h.68v3.92h-.47V17.3l0-1.13h0l-1.23,3.29Z\"\n                              transform=\"translate(0 0)\"/>\n                    </g>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>\n\n\n**Important:** _This Microsoft Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe data connector for [Mimecast Secure Email Gateway](https://community.mimecast.com/s/article/Azure-Sentinel) allows easy log collection from the Secure Email Gateway to surface email insight and user activity within Azure Sentinel. The data connector provides pre-created dashboards to allow analysts to view insight into email based threats, aid in incident correlation and reduce investigation response times coupled with custom alert capabilities. Mimecast products and features required: \n- Mimecast Secure Email Gateway \n- Mimecast Data Leak Prevention\n \n\nMicrosoft Sentinel Solutions provide a consolidated way to acquire Microsoft Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Data Connectors:** 1, **Workbooks:** 1, **Analytic Rules:** 9\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(filter.id, toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Solution installs the data connector for Mimecast Secure Email Gateway. You can get Mimecast Secure Email Gateway custom log data in your Azure Sentinel workspace. Configure and enable this data connector in the Data Connector gallery after this Solution deploys. This data connector creates custom log table(s) MimecastSIEM_CL MimecastDLP_CL in your Azure Sentinel / Azure Log Analytics workspace."
            }
          },
          {
            "name": "dataconnectors-link1",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about normalized format",
                "uri": "https://docs.microsoft.com/azure/sentinel/normalization-schema"
              }
            }
          },
          {
            "name": "dataconnectors-link2",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "workbooks",
        "label": "Workbooks",
        "subLabel": {
          "preValidation": "Configure the workbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Workbooks",
        "elements": [
          {
            "name": "workbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Azure Sentinel Solution installs workbooks. Workbooks provide a flexible canvas for data monitoring, analysis, and the creation of rich visual reports within the Azure portal. They allow you to tap into one or many data sources from Azure Sentinel and combine them into unified interactive experiences.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data"
              }
            }
          },
          {
            "name": "workbook1",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway",
            "elements": [
              {
                "name": "workbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain insights into Mimecast SEG logs."
                }
              },
              {
                "name": "workbook1-name",
                "type": "Microsoft.Common.TextBox",
                "label": "Display Name",
                "defaultValue": "Mimecast Secure Email Gateway",
                "toolTip": "Display name for the workbook.",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a workbook name"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Azure Sentinel Solution installs analytic rules for Mimecast Secure Email Gateway that you can enable for custom alert generation in Azure Sentinel. These analytic rules will be deployed in disabled mode in the analytics rules gallery of your Azure Sentinel workspace. Configure and enable these rules in the analytic rules gallery after this Solution deploys.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Data Leak Prevention - Notifications",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast DLP - Notifications analytical rule"
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Data Leak Prevention - Hold",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Data Leak Prevention - Hold"
                }
              }
            ]
          },
          {
            "name": "analytic3",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - Attachment Protect",
            "elements": [
              {
                "name": "analytic3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Attachment Protect"
                }
              }
            ]
          },
          {
            "name": "analytic4",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - AV",
            "elements": [
              {
                "name": "analytic4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - AV"
                }
              }
            ]
          },
          {
            "name": "analytic5",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - Impersonation Protect",
            "elements": [
              {
                "name": "analytic5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Targeted Threat Protection - Impersonation Protect"
                }
              }
            ]
          },
          {
            "name": "analytic6",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - Internal Email Protect",
            "elements": [
              {
                "name": "analytic6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Internal Email Protect"
                }
              }
            ]
          },
          {
            "name": "analytic7",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - Spam Event Thread",
            "elements": [
              {
                "name": "analytic7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Spam Event Thread"
                }
              }
            ]
          },
          {
            "name": "analytic8",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - URL Protect",
            "elements": [
              {
                "name": "analytic8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Targeted Threat Protection - URL Protect"
                }
              }
            ]
          },
          {
            "name": "analytic9",
            "type": "Microsoft.Common.Section",
            "label": "Mimecast Secure Email Gateway - Virus",
            "elements": [
              {
                "name": "analytic9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Mimecast Secure Email Gateway - Virus"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(filter.id, toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "workbook1-name": "[steps('workbooks').workbook1.workbook1-name]"
    }
  }
}
