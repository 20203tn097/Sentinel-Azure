alertDetailsOverride: null
customDetails:
    SAP_User: User
description: 'Identifies multiple files downloads for a user within a specific timerange.


    Source Action: Download multiple files while using SAPGui to Excel/Lists etc.


    *Data Sources: SAPcon -  Audit Log*'
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: Email
        identifier: FullName
-   entityType: IP
    fieldMappings:
    -   columnName: TerminalIPv6
        identifier: Address
-   entityType: Host
    fieldMappings:
    -   columnName: Host
        identifier: FullName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: ClientID
        identifier: AppId
eventGroupingSettings:
    aggregationKind: AlertPerResult
id: 4285d707-f969-4a8c-801f-e9c6a328d884
kind: Scheduled
name: SAP - Multiple Files Download
query: "// Define variables\r\nlet NumberOfDownloads = 10; // Number of downloads\
    \ of user as threshold\r\nlet HoursBucket = 2h; // How much time between buckets\r\
    \nlet AuditClasses = dynamic([\"AUY\"]); // Relevant message\r\n// Query logic\r\
    \nSAPAuditLog // Get all downloads\r\n| where MessageID in (AuditClasses)\r\n\
    | summarize DownloadsByUser = count() by bin(TimeGenerated, HoursBucket), SystemID,\
    \ ClientID, User, TerminalIPv6, Email, Host\r\n| where DownloadsByUser >= NumberOfDownloads\
    \ // User downloaded more than threshold\r\n| project SystemID, ClientID, User,\
    \ Email, TerminalIPv6, Host,DownloadsByUser"
queryFrequency: 12h
queryPeriod: 12h
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPAuditLog
severity: Medium
tactics:
- Collection
- Exfiltration
- CredentialAccess
triggerOperator: gt
triggerThreshold: 0
version: 2.0.15
