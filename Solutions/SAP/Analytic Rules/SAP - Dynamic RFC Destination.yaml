id: 57e99014-746b-4696-ae6a-447aecc9e800
name: SAP - Dynamic RFC Destination
description: |-
  'Identifies execution of RFC using dynamic destinations. Source Action: Execute an ABAP report which is using dynamic destinations (cl_dynamic_destination). Sample report: DEMO_RFC_DYNAMIC_DEST. *Data Sources: SAPcon - Audit Log*
  '
severity: Low
requiredDataConnectors:
- connectorId: SAP
  dataTypes:
  - SAPAuditLog
queryFrequency: 6h
queryPeriod: 6h
triggerOperator: gt
triggerThreshold: 0
tactics:
- Collection
- Exfiltration
relevantTechniques: ''
query: |-
  // Define variables
  let AuditClasses = dynamic(['FU1']); // Message of dynamic RFC execution using dynamic destination
  // Query logic
  SAPAuditLog
  | where MessageID in (AuditClasses)
  | parse Variable3 with "id=" Created_RFC_Name
  | project TimeGenerated,Instance, SystemID, ClientID, User, Email, TerminalIPv6, Host, ABAPProgramName, ExecutedProgram = Variable2, Created_RFC_Name
  | extend AlertRuleUniqueName = 'dynamicrfcdestination'
alertDetailsOverride: null
customDetails:
  SAP_User: User
  AlertRuleUniqueName: AlertRuleUniqueName
entityMappings:
- entityType: Account
  fieldMappings:
  - identifier: FullName
    columnName: Email
- entityType: IP
  fieldMappings:
  - identifier: Address
    columnName: TerminalIPv6
- entityType: Host
  fieldMappings:
  - identifier: FullName
    columnName: Host
- entityType: CloudApplication
  fieldMappings:
  - identifier: Name
    columnName: SystemID
  - identifier: AppId
    columnName: ClientID
  - identifier: InstanceName
    columnName: Instance
eventGroupingSettings:
  aggregationKind: SingleAlert
kind: Scheduled
version: 2.0.19
