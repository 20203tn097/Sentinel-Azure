alertDetailsOverride: null
customDetails:
    SAP_User: User
description: 'Identifies execution of dynamic ABAP programming. For example, ABAP
    code was dynamically created/changed/deleted. Source Action: Create an ABAP Report
    which uses ABAP program generation commands such as "INSERT REPORT" and execute
    it. Excluded Transaction Codes can be maintained in "SAP - Transactions for ABAP
    Generations" watchlist. *Data Sources: SAPcon - Audit Log*

    '
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: Email
        identifier: FullName
-   entityType: IP
    fieldMappings:
    -   columnName: TerminalIPv6
        identifier: Address
-   entityType: Host
    fieldMappings:
    -   columnName: Host
        identifier: HostName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: ClientID
        identifier: AppId
    -   columnName: Instance
        identifier: InstanceName
eventGroupingSettings:
    aggregationKind: SingleAlert
id: fd655ec6-cb11-4e79-a825-0935a66596c8
kind: Scheduled
name: SAP - Dynamic ABAP Program
query: |
    // Define variables
    let AuditClasses = dynamic(['BU4']); // Message of dynamic ABAP program
    let TranForABAPGen = _GetWatchlist("SAP - Transactions for ABAP Generations"); // Transactions to exclude
    // Maintain if watchlist is not available
    let fixedTran = datatable(TransactionCode:string)['SE11','SE12', "SE16", "SE16N"];
    let UnitedTransactions =
    toscalar(union TranForABAPGen, fixedTran
    | summarize Transactions = make_set(TransactionCode));
    // Query logic
    SAPAuditLog
    | where MessageID in (AuditClasses)
    | where TransactionCode !in (UnitedTransactions) // Exclude transactions
    | project TimeGenerated, Instance, User, SystemID, ClientID, Email, TerminalIPv6, Host, ABAPProgramName
queryFrequency: 6h
queryPeriod: 6h
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPAuditLog
severity: Low
tactics:
- Discovery
- CommandAndControl
- Impact
triggerOperator: gt
triggerThreshold: 0
version: 2.0.19
