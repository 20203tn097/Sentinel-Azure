alertDetailsOverride: null
customDetails:
    SAP_User: User
description: 'Identifies changes for runtime data during a debugging activity.

    Source Action: Activate Debug ("/h"), Select a field for change and update it''s
    value.


    **Recommended for Production only**


    *Data Sources: SAPcon -  Audit Log*'
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: Email
        identifier: FullName
-   entityType: IP
    fieldMappings:
    -   columnName: TerminalIPv6
        identifier: Address
-   entityType: Host
    fieldMappings:
    -   columnName: Host
        identifier: FullName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: ClientID
        identifier: AppId
    -   columnName: Instance
        identifier: InstanceName
eventGroupingSettings:
    aggregationKind: SingleAlert
id: 9a55136c-fa19-46d4-9376-17c8f96cc2b8
kind: Scheduled
name: SAP - Data has Changed during Debugging Activity
query: "let Role = 'Production';\r\nlet AuditClasses = dynamic(['CUL']); // Audit\
    \ Log Classes - Debug Change\r\nlet allSystemRoles = dynamic(['Sandbox','Developement','QualityAssurance','Training','Production']);\
    \ // Available System Roles\r\nlet allSystemUsage = dynamic (['ERP','CRM','BW','Solman','Gateway','Enterprise\
    \ Portal']); // Available System Usages\r\n// Get Relevant Systems from WatchList\r\
    \nlet systemID = _GetWatchlist('SAP - Systems');\r\nlet fixedSID = datatable(SystemID:string,\
    \ SystemRole:string, SystemUsage:string)\r\n// Maintain these if WatchList is\
    \ not available    \r\n    [\"S4H\",\"Production\",\"ERP\",\r\n    \"XXX\",\"\
    Sandbox\",\"BW\"]\r\n;\r\nlet UnitedSystem = \r\nunion systemID, fixedSID\r\n\
    | summarize by SystemID, SystemRole, SystemUsage\r\n| where SystemRole == Role;\
    \ // Recommended  is Production only\r\n//| where SystemRole in (allSystemRoles);\
    \ // Use this for all system roles\r\nSAPAuditLog \r\n| where MessageID in (AuditClasses)\r\
    \n| project-rename SystemIDTemp = SystemID \n| project-rename SystemID= SystemIDTemp\
    \ \n| project-rename SystemID= SystemID\r\n| lookup kind = inner    (UnitedSystem)\
    \ on SystemID\r\n| extend  ChangeDetails = pack_array(Variable1, Variable2, Variable3,\
    \ Variable4)\r\n| project TimeGenerated,ClientID, Instance, User, MessageText,\
    \ ChangeDetails, ABAPProgramName, TransactionCode, SystemID, SystemRole, SystemUsage,\
    \ Email,TerminalIPv6, Host"
queryFrequency: 1h
queryPeriod: 1h
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPAuditLog
severity: High
tactics:
- Execution
- LateralMovement
triggerOperator: gt
triggerThreshold: 0
version: 2.0.15
