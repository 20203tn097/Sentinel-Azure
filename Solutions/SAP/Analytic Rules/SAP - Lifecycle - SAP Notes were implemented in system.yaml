id: 7f364fac-c6a9-4935-a73b-ba215acace31
name: SAP - Lifecycle - SAP Notes were implemented in system
description: |-
  'Identifies SAP Notes implementation in the system.

  Source Action: Implement SAP Note using SNOTE/TCI.

  *Data Sources: SAPcon -  Change Requests*
  '
severity: Informational
requiredDataConnectors:
- connectorId: SAP
  dataTypes:
  - SAPAuditLog
  - SAPCRLog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics: []
relevantTechniques: ''
query: |-
  // Define variables
  let VarNote = "NOTE";
  let AuditLogIn = dynamic(['AU1', 'AU5']); // Messages of connect with user
  // Query logic
  let LastLogin =
  SAPAuditLog
  | where MessageID in (AuditLogIn)
  | summarize TimeGenerated = arg_max(TimeGenerated, *) by SystemID, ClientID, User; // Get last connection date for user
  SAPCRLog
  | where ObjectType == VarNote // Type is NOTE
  | lookup kind=inner LastLogin on $left.Owner == $right.User // Get last login details
  | summarize by TimeGenerated, Instance, SystemID, SystemNumber, ClientID, Owner, Request, Description, ObjectName, Category, Status, Email, TerminalIPv6, Host
  | extend AlertRuleUniqueName = 'lifecycle-sapnoteswereimplementedinsystem'
alertDetailsOverride: null
customDetails:
  SAP_User: Owner
  AlertRuleUniqueName: AlertRuleUniqueName
entityMappings:
- entityType: Account
  fieldMappings:
  - identifier: FullName
    columnName: Email
- entityType: IP
  fieldMappings:
  - identifier: Address
    columnName: TerminalIPv6
- entityType: Host
  fieldMappings:
  - identifier: FullName
    columnName: Host
- entityType: CloudApplication
  fieldMappings:
  - identifier: Name
    columnName: SystemID
  - identifier: AppId
    columnName: ClientID
  - identifier: InstanceName
    columnName: Instance
eventGroupingSettings:
  aggregationKind: SingleAlert
kind: Scheduled
version: 2.0.19
