alertDetailsOverride: null
customDetails:
    SAP_User: User
description: 'Identifies testing of a function module.


    Source Action: Test a function module using  SE37 / SE80.


    **Recommended for Production only**


    *Data Sources: SAPcon -  Audit Log*'
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: Email
        identifier: FullName
-   entityType: IP
    fieldMappings:
    -   columnName: TerminalIPv6
        identifier: Address
-   entityType: Host
    fieldMappings:
    -   columnName: Host
        identifier: FullName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: ClientID
        identifier: AppId
    -   columnName: Instance
        identifier: InstanceName
eventGroupingSettings:
    aggregationKind: SingleAlert
id: 7e6cb00d-d7cb-4411-837f-6e62c2fab6e7
kind: Scheduled
name: SAP - Function Module tested
query: "let Role = 'Production';\r\nlet ProgramName = 'RS_TESTFRAME_CALL';\r\nlet\
    \ AuditClasses = dynamic(['AUW']); // Audit Log Classes - Report Started\r\nlet\
    \ allSystemRoles = dynamic(['Sandbox', 'Developement', 'QualityAssurance', 'Training',\
    \ 'Production']); // Available System Roles\r\nlet allSystemUsage = dynamic (['ERP',\
    \ 'CRM', 'BW', 'Solman', 'Gateway', 'Enterprise Portal']); // Available System\
    \ Usages\r\n// Get Relevant Systems from WatchList\r\nlet systemID = _GetWatchlist('SAP\
    \ - Systems');\r\nlet fixedSID = datatable(SystemID: string, SystemRole: string,\
    \ SystemUsage: string)\r\n    // Maintain these if WatchList is not available\
    \    \r\n    [\"S4H\", \"Production\", \"ERP\",\r\n    \"XXX\", \"Sandbox\", \"\
    BW\"]\r\n; \r\nlet UnitedSystem = \r\nunion systemID, fixedSID\r\n| summarize\
    \ by SystemID, SystemRole, SystemUsage\r\n| where SystemRole == Role; // Reccommended\
    \ is Production only\r\n//| where SystemRole in (allSystemRoles); // Use this\
    \ for all system roles\r\nSAPAuditLog \r\n| where MessageID in (AuditClasses)\r\
    \n| where ABAPProgramName == ProgramName\r\n| project-rename SystemIDTemp = SystemID\
    \ \n| project-rename SystemID= SystemIDTemp \n| project-rename SystemID= SystemID\r\
    \n| lookup kind = inner (UnitedSystem) on SystemID\r\n| order by TimeGenerated\
    \ asc\r\n| project TimeGenerated, Instance ,User, SystemID, ClientID, MessageText,\
    \ MessageID,\r\nEmail, TerminalIPv6, Host "
queryFrequency: 6h
queryPeriod: 6h
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPAuditLog
severity: High
tactics:
- Collection
- DefenseEvasion
- LateralMovement
triggerOperator: gt
triggerThreshold: 0
version: 2.0.15
