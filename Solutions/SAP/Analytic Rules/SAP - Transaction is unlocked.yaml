alertDetailsOverride: null
customDetails:
    SAP_User: User
description: "Identifies unlocking of a transaction. \n\nSource Action: Unlock a transaction\
    \ code using SM01/SM01_DEV/SM01_CUS.\n\n*Data Sources: SAPcon -  Audit Log*\n"
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: Email
        identifier: FullName
-   entityType: IP
    fieldMappings:
    -   columnName: TerminalIPv6
        identifier: Address
-   entityType: Host
    fieldMappings:
    -   columnName: Host
        identifier: FullName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: ClientTR
        identifier: AppId
    -   columnName: Instance
        identifier: InstanceName
eventGroupingSettings:
    aggregationKind: SingleAlert
id: 35ff4cf7-ed01-4ec2-92e5-ffcbf88fb294
kind: Scheduled
name: SAP - Transaction is unlocked
query: "// Audit Log Classes - Transaction UnLock Events\r\n// AUP - Transaction Locked\r\
    \nlet AuditClasses = dynamic(['AUQ']); // AUQ - Transaction Unlocked\r\nSAPAuditLog\
    \ \r\n| where MessageID in (AuditClasses)\r\n| project-rename TransactionCodeTemp\
    \ = TransactionCode \n| project-rename TransactionCode= Variable1\r\n| parse TransactionCode\
    \ with \"( TR ) \" _TCODE \" - \" ClientTR // Parse to _TCODE and ClientTR\r\n\
    // Specific Client Action (SM01_CUS) / Cross Client (SM01_DEV)\r\n| extend TransactionCode\
    \ = iif(_TCODE != \"\",_TCODE, TransactionCode) // Check if _TCODE is not empty\r\
    \n| extend ClientTR = iif(ClientTR != \"\",ClientTR, \"CrossClient\") // Check\
    \ if ClientTR is not empty\r\n| project \r\n// Details\r\nTimeGenerated, Instance,\
    \ SystemID, User, MessageText,TransactionCode, ClientTR,\r\nEmail, TerminalIPv6,\
    \ Host\r\n\r\n"
queryFrequency: 1d
queryPeriod: 1d
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPAuditLog
severity: Medium
tactics:
- Persistence
- Execution
triggerOperator: gt
triggerThreshold: 0
version: 2.0.15
