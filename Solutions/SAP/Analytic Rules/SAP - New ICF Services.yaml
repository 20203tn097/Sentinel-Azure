alertDetailsOverride:
    alertDescriptionFormat: 'Identifies creation of ICF Services.

        Source Action: Create a service using SICF.

        *Data Sources: SAPcon - Table Data Log*'
    alertDisplayNameFormat: (Preview) SAP - High - New ICF Services created by {{User}}
        in system {{SystemID}}
    alertSeverityColumnName: Dummy
    alertTacticsColumnName: Dummy
customDetails:
    SAP_User: User
description: 'Identifies creation of ICF Services.

    Source Action: Create a service using SICF.

    *Data Sources: SAPcon - Table Data Log*'
entityMappings:
-   entityType: Account
    fieldMappings:
    -   columnName: PrimaryEmail
        identifier: FullName
-   entityType: CloudApplication
    fieldMappings:
    -   columnName: SystemID
        identifier: Name
    -   columnName: Client
        identifier: AppId
    -   columnName: Instance
        identifier: InstanceName
-   entityType: IP
    fieldMappings:
    -   columnName: LastKnownIP
        identifier: Address
eventGroupingSettings:
    aggregationKind: SingleAlert
id: 263ea651-10c8-48a6-a5ac-2c9fc0655ebc
kind: Scheduled
name: SAP - New ICF Services
query: "// New ICF Services\r\nlet TimeAgo= 2h;\r\nSAPTableDataLog\r\n| where TableName\
    \ == \"ICFSERVLOC\"\r\n| where TimeGenerated > TimeAgo\r\n| where TableField ==\
    \ \"ICF_NAME\" // Service name\r\n| where OldValue == \"\" and NewValue != \"\"\
    \ // New value is inserted in name -> new service\r\n| order by TimeGenerated\
    \ desc\r\n| lookup SAPUsersHeader() on SystemID, $left.UserName== $right.User\r\
    \n| extend TerminalIPv6= iff(isnotempty( LastKnownIP), LastKnownIP, PrimaryIP)\r\
    \n| project TimeGenerated, Service = NewValue, PrimaryIP, PrimaryEmail, KnownIPs,\
    \ KnownEmails, LastKnownIP, User= UserName, Host, SystemID, Client, Instance\r\
    \n| extend Dummy= ''"
queryFrequency: 2h
queryPeriod: 2d
relevantTechniques: ''
requiredDataConnectors:
-   connectorId: SAP
    dataTypes:
    - SAPUsersHeader
    - SAPTableDataLog
severity: High
tactics:
- CommandAndControl
- Persistence
- LateralMovement
triggerOperator: gt
triggerThreshold: 0
version: 2.0.15
