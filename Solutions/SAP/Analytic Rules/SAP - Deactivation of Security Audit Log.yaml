id: 45fb7bf5-783b-4a87-897d-b26f5574186b
name: SAP - Deactivation of Security Audit Log
description: |-
  'Identifies deactivation of Security Audit Log

  Source Action: Disable secruity Audit Log using SM19/RSAU_CONFIG.

  *Data Sources: SAPcon -  Audit Log*
  '
severity: High
requiredDataConnectors:
- connectorId: SAP
  dataTypes:
  - SAPAuditLog
queryFrequency: 1h
queryPeriod: 2h
triggerOperator: gt
triggerThreshold: 0
tactics:
- Exfiltration
- DefenseEvasion
- Persistence
relevantTechniques: ''
query: |-
  // Audit Log Classes - Audit Log Active Status Events
  let AuditClasses = dynamic(['AUJ']);
  SAPAuditLog
  | where MessageID in (AuditClasses)
  | where Variable1 == '0' // Audit Active Status = 0
  | project
  // Details
  TimeGenerated, Instance ,SystemID, ClientID, User, MessageText, Email, TerminalIPv6, Host
  | extend AlertRuleUniqueName = 'deactivationofsecurityauditlog'
alertDetailsOverride: null
customDetails:
  SAP_User: User
  AlertRuleUniqueName: AlertRuleUniqueName
entityMappings:
- entityType: Account
  fieldMappings:
  - identifier: FullName
    columnName: Email
- entityType: IP
  fieldMappings:
  - identifier: Address
    columnName: TerminalIPv6
- entityType: Host
  fieldMappings:
  - identifier: FullName
    columnName: Host
- entityType: CloudApplication
  fieldMappings:
  - identifier: Name
    columnName: SystemID
  - identifier: AppId
    columnName: ClientID
  - identifier: InstanceName
    columnName: Instance
eventGroupingSettings:
  aggregationKind: SingleAlert
kind: Scheduled
version: 2.0.54
