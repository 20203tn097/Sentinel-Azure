{
    "properties": {
        "category": "SAPFunctions",
        "displayName": "SAPUsersEmail",
        "query": "let UserMDLookBack = totimespan(toscalar(SAPGetParameters('UserMDLookBack')| project-keep ValueLow));\r\n\r\nSAP_USR21 | where TimeGenerated > ago(UserMDLookBack)\r\n| summarize arg_max(TimeGenerated, ADDRNUMBER, PERSNUMBER) by BNAME, MANDT, SystemID\r\n| project-rename CLIENT= MANDT\r\n| join kind= leftouter hint.strategy=shuffle \r\n(SAP_ADR6 | where TimeGenerated > ago(UserMDLookBack) \r\n| summarize arg_max(TimeGenerated, CONSNUMBER ) by CLIENT, DATE_FROM, ADDRNUMBER, PERSNUMBER, SystemID, SMTP_ADDR)\r\n on ADDRNUMBER, PERSNUMBER, SystemID, CLIENT\r\n| project SystemID, ClientID= CLIENT, User= BNAME, Email= iff(isempty(SMTP_ADDR), BNAME, SMTP_ADDR)\r\n| summarize Email= anyif(Email, isnotempty(Email) ) by ClientID, SystemID, User\r\n",
        "functionAlias": "SAPUsersEmail",
        "version": "2.0.15",
        "etag": "*"
    },
    "name": "SAPUsersEmail",
    "type": "savedSearches",
    "apiVersion": "2020-08-01"
}