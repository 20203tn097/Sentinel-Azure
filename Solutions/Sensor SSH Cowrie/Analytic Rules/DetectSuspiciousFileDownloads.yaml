id: b86b27e3-adb9-4f39-8c4e-0b7300031984
name: Detect Suspicious File Downloads
description: |
  'Identify instances where files were downloaded from suspicious or known malicious URLs.'
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: Cowrie
    dataTypes:
      - newCowrie_CL
queryFrequency: 5m
queryPeriod: 5m
triggerOperator: gt
triggerThreshold: 0
tactics:
  - LateralMovement
relevantTechniques:
  - T0843
query: |
newCowrie_CL
| extend EventID = tostring(parse_json(RawData).eventid),
  URL = tostring(parse_json(RawData).url),
  SourceIP = tostring(parse_json(RawData).src_ip)
| where EventID == "cowrie.session.file_download"
| where URL contains "malicious-site.com" or URL contains "suspicious"
| project SourceIP, URL
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: SourceIP
        columnName: IPCustomEntity
version: 1.0.1
kind: Scheduled