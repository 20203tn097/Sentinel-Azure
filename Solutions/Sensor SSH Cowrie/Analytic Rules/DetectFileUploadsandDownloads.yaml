id: 53016cac-ca6c-4b2b-a4c4-7325afcb9502
name: Detect File Uploads and Downloads
description: |
  'Monitor file uploads and downloads to detect potential exfiltration or data theft activities.'
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: Cowrie
    dataTypes:
      - newCowrie_CL
queryFrequency: 5m
queryPeriod: 5m
triggerOperator: gt
triggerThreshold: 0
tactics:
  - LateralMovement
relevantTechniques:
  - T0843
query: |
  newCowrie_CL
| extend EventID = tostring(parse_json(RawData).eventid),
  URL = tostring(parse_json(RawData).url),
  SourceIP = tostring(parse_json(RawData).src_ip),
 	SHA256 = tostring(parse_json(RawData).shasum),
  Outfile = tostring(parse_json(RawData).outfile)
| where EventID in ("cowrie.session.file_upload", "cowrie.session.file_download")
| project EventID, SourceIP, URL, Outfile, SHA256
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: SourceIP
        columnName: IPCustomEntity
entityMappings:
  - entityType: File
    fieldMappings:
      - identifier: OutFile
        columnName: FileCustomEntity
entityMappings:
  - entityType: File
    fieldMappings:
      - identifier: SHA256
        columnName: SHA256CustomEntity
entityMappings:
  - entityType: URL
    fieldMappings:
      - identifier: URL
        columnName: URLCustomEntity
version: 1.0.1
kind: Scheduled