id: bf03796a-3ed7-440f-bfc3-0c702cf762a9
name: Chain of 3 or more roles
description: |
  'detects chains of more than 3 roles in the account, this is a misconfiguration that can enable lateral movement.'
requiredDataConnectors:
  - connectorId: Authomize
    dataTypes:
      - Authomize_v2_CL
tactics:
  - PrivilegeEscalation
relevantTechniques:
  - T0890
query: |
  union withsource=_TableName Authomize_v2_CL
  | extend EventID = id_s
  | extend Policy = policy_name_s
  | extend Severity = severity_s
  | extend Description = description_s
  | extend Recommendation = recommendation_s
  | extend URL = url_s
  | extend Tactics = tactics_s
  | where Policy contains "Chain of 3 or more roles"
  | project EventID, Policy, Severity, Description, Recommendation, URL, Category, Tactics
  | extend CloudApplication_0_Name = Policy
entityMappings:
  - entityType: CloudApplication
    fieldMappings:
      - identifier: Name
        columnName: Policy
version: 1.0.0
metadata:
    source:
        kind: Authomize
    author:
        name: Steven Riley
    support:
        tier: support@authomize.com