{
  "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
  "view": {
      "kind": "Form",
      "properties": {
          "title": "Test Form View",
          "steps": [
      {
                  "name": "basics",
                  "label": "Basics",
        "description": "<img src=\"https://raw.githubusercontent.com/johnpcmatic/Azure-Sentinel/pcm-sentinel/Solutions/PCMatic%20SuperShield/Logo/pcmatic-green-outline.png\" width=\"200px\" height=\"45px\">\n\n**Important:** _This Microsoft Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThis PC Matic SuperShield Sentinel solution provides the capability to ingest [PC Matic SuperShield](https://www.pcmatic.com/pro/) process activity events with Microsoft Sentinel. It helps you gain visibility into what applications and processes are being executed on your endpoints, and which of those are blocked by SuperShield.\n\nMicrosoft Sentinel Solutions provide a consolidated way to acquire Microsoft Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Data Connectors:** 1, **Parsers:** 1, **Analytic Rules:** 3, **Playbooks:** 2\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)\n\n**Required:** If you do not have an existing Sentinel Workspace, please create one by going to Microsoft Sentinel and clicking on the \"Create\" tab. Follow the wizard to create a new Sentinel Workspace.",
        "elements": [
          {
                          "name": "resourceScope",
                          "type": "Microsoft.Common.ResourceScope",
                          "location": {
                              "resourceTypes": [
                                  "microsoft.resources/resourcegroups"
                              ]
                          }
                      },
          {
            "name": "getLAWorkspace",
            "type": "Microsoft.Solutions.ArmApiControl",
            "toolTip": "This filters by workspaces that exist in the Resource Group selected",
            "condition": "",
            "request": {
              "method": "GET",
              "path": "[concat(steps('basics').resourceScope.subscription.id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
            }
          },
          {
            "name": "workspace",
            "type": "Microsoft.Common.DropDown",
            "label": "Workspace",
            "placeholder": "Select a workspace",
            "toolTip": "Please select your Sentinel workspace. If you do not see the workspace listed here, please make sure you have selected the correct Resource Group and you have created a Sentinel workspace in that group.",
            "constraints": {
            "allowedValues": "[map(filter(steps('basics').getLAWorkspace.value, (filter) => contains(toLower(filter.id), toLower(steps('basics').resourceScope.resourceGroup.name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
            "required": true
            },
            "visible": true
          }
        ]
      },
              {
                  "name": "keyvault",
                  "label": "Key Vault",
        "description": "The Azure Key Vault created here will be used to store your PC Matic API credentials. The credentials are used by PC Matic's custom Logic Apps to communicate with PC Matic servers.",
                  "elements": [
                      {
                          "name": "keyVaultName",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Key Vault Name",
                          "defaultValue": "KeyVault",
                          "toolTip": "Specifies the name of the key vault to be created.",
                          "constraints": {
                              "required": true,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "location",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Location",
                          "defaultValue": "[steps('basics').resourceScope.resourceGroup.location]",
                          "toolTip": "Specifies the Azure location where the key vault should be created.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "enabledForDeployment",
                          "type": "Microsoft.Common.DropDown",
                          "label": "Enabled For Deployment",
                          "defaultValue": "false",
                          "toolTip": "Specifies whether Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault.",
                          "constraints": {
                              "required": false,
                              "allowedValues": [
                                  {
                                      "label": "true",
                                      "value": true
                                  },
                                  {
                                      "label": "false",
                                      "value": false
                                  }
                              ]
                          },
                          "visible": true
                      },
                      {
                          "name": "enabledForDiskEncryption",
                          "type": "Microsoft.Common.DropDown",
                          "label": "Enabled For Disk Encryption",
                          "defaultValue": "false",
                          "toolTip": "Specifies whether Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys.",
                          "constraints": {
                              "required": false,
                              "allowedValues": [
                                  {
                                      "label": "true",
                                      "value": true
                                  },
                                  {
                                      "label": "false",
                                      "value": false
                                  }
                              ]
                          },
                          "visible": true
                      },
                      {
                          "name": "enabledForTemplateDeployment",
                          "type": "Microsoft.Common.DropDown",
                          "label": "Enabled For Template Deployment",
                          "defaultValue": "false",
                          "toolTip": "Specifies whether Azure Resource Manager is permitted to retrieve secrets from the key vault.",
                          "constraints": {
                              "required": false,
                              "allowedValues": [
                                  {
                                      "label": "true",
                                      "value": true
                                  },
                                  {
                                      "label": "false",
                                      "value": false
                                  }
                              ]
                          },
                          "visible": true
                      },
                      {
                          "name": "tenantId",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Tenant Id",
                          "defaultValue": "[steps('basics').resourceScope.subscription.tenantId]",
                          "toolTip": "Specifies the Azure Active Directory tenant ID that should be used for authenticating requests to the key vault. Get it by using Get-AzSubscription cmdlet.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "objectId",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Object Id",
                          "defaultValue": "",
                          "toolTip": "Specifies the object ID of a user, service principal or security group in the Azure Active Directory tenant for the vault. The object ID must be unique for the list of access policies. Get it by using Get-AzADUser or Get-AzADServicePrincipal cmdlets.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
          {
                          "name": "applicationId",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Application Id",
                          "defaultValue": "",
                          "toolTip": "Specifies the application ID of a user, service principal or security group in the Azure Active Directory tenant for the vault. The application ID must be unique for the list of access policies. Get it by using Get-AzADUser or Get-AzADServicePrincipal cmdlets.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "keysPermissions",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Keys Permissions",
                          "defaultValue": "[[\"list\"]",
                          "toolTip": "Specifies the permissions to keys in the vault. Valid values are: all, encrypt, decrypt, wrapKey, unwrapKey, sign, verify, get, list, create, update, import, delete, backup, restore, recover, and purge.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "secretsPermissions",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Secrets Permissions",
                          "defaultValue": "[[\"list\"]",
                          "toolTip": "Specifies the permissions to secrets in the vault. Valid values are: all, get, list, set, delete, backup, restore, recover, and purge.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "skuName",
                          "type": "Microsoft.Common.DropDown",
                          "label": "Sku Name",
                          "defaultValue": "Standard",
                          "toolTip": "Specifies whether the key vault is a standard vault or a premium vault.",
                          "constraints": {
                              "required": false,
                              "allowedValues": [
                                  {
                                      "label": "Standard",
                                      "value": "Standard"
                                  },
                                  {
                                      "label": "Premium",
                                      "value": "Premium"
                                  }
                              ]
                          },
                          "visible": true
                      },
                      {
                          "name": "secretName",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Secret Name",
                          "defaultValue": "",
                          "toolTip": "Specifies the name of the secret that you want to create.",
                          "constraints": {
                              "required": true,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "secretValue",
                          "type": "Microsoft.Common.PasswordBox",
                          "label": {
                              "password": "Secret Value",
                              "confirmPassword": "Confirm password"
                          },
                          "toolTip": "Specifies the value of the secret that you want to create.",
                          "constraints": {
                              "required": true,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "options": {
                              "hideConfirmation": true
                          },
                          "visible": true
                      }
        ]
      },
              {
        "name": "workbook",
        "label": "Sentinel Workbook",
        "elements": [
          {
                          "name": "workbookDisplayName",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workbook Display Name",
                          "defaultValue": "Incident overview - pcmatic",
                          "toolTip": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group.",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "workbookType",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workbook Type",
                          "defaultValue": "sentinel",
                          "toolTip": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "workbookSourceId",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workbook Source Id",
                          "defaultValue": "/subscriptions/b4c56e1b-e902-4c40-9681-12b933c3ba73/resourcegroups/pcmatic-logs/providers/microsoft.operationalinsights/workspaces/pcmatic",
                          "toolTip": "The id of resource instance to which the workbook will be associated",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "workbookId",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workbook Id",
                          "defaultValue": "[[newGuid()]",
                          "toolTip": "The unique guid for this workbook instance",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      }
        ]
      },
      {
        "name": "logicapps",
        "label": "Logic Apps/Playbooks",
        "elements": [
          {
                          "name": "connections_keyvault_name",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Connections_keyvault_name",
                          "defaultValue": "keyvault",
                          "toolTip": "",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "workflows_RemoveProcess_name",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workflows_Remove Process_name",
                          "defaultValue": "RemoveProcess",
                          "toolTip": "",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "connections_azuresentinel_name",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Connections_azuresentinel_name",
                          "defaultValue": "azuresentinel",
                          "toolTip": "",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      },
                      {
                          "name": "workflows_BlockAllowProcess_name",
                          "type": "Microsoft.Common.TextBox",
                          "label": "Workflows_Block Allow Process_name",
                          "defaultValue": "BlockAllowProcess",
                          "toolTip": "",
                          "constraints": {
                              "required": false,
                              "regex": "",
                              "validationMessage": ""
                          },
                          "visible": true
                      }
        ]
      }
          ]
      },
      "outputs": {
          "parameters": {
      "workspace": "[steps('basics').workspace]",
              "keyVaultName": "[steps('keyvault').keyVaultName]",
              "location": "[steps('keyvault').location]",
              "enabledForDeployment": "[steps('keyvault').enabledForDeployment]",
              "enabledForDiskEncryption": "[steps('keyvault').enabledForDiskEncryption]",
              "enabledForTemplateDeployment": "[steps('keyvault').enabledForTemplateDeployment]",
              "tenantId": "[steps('keyvault').tenantId]",
              "objectId": "[steps('keyvault').objectId]",
      "applicationId": "[steps('keyvault').applicationId]",
              "keysPermissions": "[steps('keyvault').keysPermissions]",
              "secretsPermissions": "[steps('keyvault').secretsPermissions]",
              "skuName": "[steps('keyvault').skuName]",
              "secretName": "[steps('keyvault').secretName]",
              "secretValue": "[steps('keyvault').secretValue]",
              "workbookDisplayName": "[steps('workbook').workbookDisplayName]",
              "workbookType": "[steps('workbook').workbookType]",
              "workbookSourceId": "[steps('workbook').workbookSourceId]",
              "workbookId": "[steps('workbook').workbookId]",
              "connections_keyvault_name": "[steps('logicapps').connections_keyvault_name]",
              "workflows_RemoveProcess_name": "[steps('logicapps').workflows_RemoveProcess_name]",
              "connections_azuresentinel_name": "[steps('logicapps').connections_azuresentinel_name]",
              "workflows_BlockAllowProcess_name": "[steps('logicapps').workflows_BlockAllowProcess_name]"
          },
          "kind": "ResourceGroup",
          "location": "[steps('basics').resourceScope.location.name]",
          "resourceGroupId": "[steps('basics').resourceScope.resourceGroup.id]"
      }
  }
}