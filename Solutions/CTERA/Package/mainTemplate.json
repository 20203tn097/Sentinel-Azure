{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "CTERA Networks - support@ctera.com ",
    "comments": "Solution template for CTERA"
   },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "CTERA",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "CTERA",
    "_solutionVersion": "3.0.0",
    "solutionId": "microsoft.sentinel-solution-ctera",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "CTERA_UI_Config",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CTERA_DataConnector",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-', uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "d5d4766b-e547-44da-9d85-48ff393db201",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'd5d4766b-e547-44da-9d85-48ff393db201')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('d5d4766b-e547-44da-9d85-48ff393db201')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','d5d4766b-e547-44da-9d85-48ff393db201','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "7a075edf-1cf2-4038-ba9c-c354db6409de",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7a075edf-1cf2-4038-ba9c-c354db6409de')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7a075edf-1cf2-4038-ba9c-c354db6409de')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7a075edf-1cf2-4038-ba9c-c354db6409de','-', '1.0.0')))]"
    },
     "huntingQueryObject1": {
        "huntingQueryVersion1": "1.0.0",
        "_huntingQueryContentId1": "26f7d89a-b7b7-47cb-ad11-281f66c17c3d",
        "huntingQueryId1": "[resourceId('Microsoft.SecurityInsights/HuntingQueryTemplates', '26f7d89a-b7b7-47cb-ad11-281f66c17c3d')]",
        "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('26f7d89a-b7b7-47cb-ad11-281f66c17c3d')))]"
    },
    "huntingQueryObject2": {
        "huntingQueryVersion2": "1.0.0",
        "_huntingQueryContentId2": "694ce74e-968b-4ca0-ae24-53bcfd87bf0a",
        "huntingQueryId2": "[resourceId('Microsoft.SecurityInsights/HuntingQueryTemplates', '694ce74e-968b-4ca0-ae24-53bcfd87bf0a')]",
        "huntingQueryTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('694ce74e-968b-4ca0-ae24-53bcfd87bf0a')))]"
    },
    "huntingQueryObject3": {
        "huntingQueryVersion3": "1.0.0",
        "_huntingQueryContentId3": "23206903-0c36-4d68-ba4b-169c67355b53",
        "huntingQueryId3": "[resourceId('Microsoft.SecurityInsights/HuntingQueryTemplates', '23206903-0c36-4d68-ba4b-169c67355b53')]",
        "huntingQueryTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('23206903-0c36-4d68-ba4b-169c67355b53')))]"
    },
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "CTERA_Workbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]",
    "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace'))]"
  },
  "resources": [
	{
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CTERAOverviewWorkbook Workbook with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This Workbook provides insights into CTERA logs and operations."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# CTERA Logs Overview\\n---\\n\\nThis Workbook provides an overview of CTERA log ingestion and operations.\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CTERALogs\\n| where TimeGenerated >= ago(30d)\\n| summarize OperationCount = count() by OperationType\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"seriesLabelSettings\":{\"label\":\"OperationType\"},\"yAxisLabelSettings\":{\"label\":\"OperationCount\"}}},\"name\":\"query - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"TimeRange\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":2592000000}],\"defaultDurationMs\":86400000},\"value\":{\"durationMs\":86400000}}],\"style\":\"dropdown\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameter - TimeRange\"}]},\"fromTemplateId\":\"CTERAOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=CTERAOverview; logoFileName=CTERA_Logo.svg; description=This Workbook provides insights into CTERA logs and operations.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=CTERA Logs Overview; templateRelativePath=CTERAOverviewWorkbook.json; provider=CTERA; support=; author=CTERA; categories=}.description",
                "parentId": "[resourceId('Microsoft.Insights/workbooks', variables('workbookId1'))]",
                "contentId": "[variables('_workbookcontentProductId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "CTERA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTERA",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "CTERA",
                  "name": "CTERA Networks",
                  "link": "https://support.ctera.com",
                  "email": "support@ctera.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CTERALogs",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookcontentProductId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_workbookcontentProductId1'))]",
        "version": "[variables('workbookVersion1')]"
      }
    },
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
	  "name": "[variables('dataConnectorTemplateSpecName1')]",
	  "location": "[parameters('workspace-location')]",
	  "dependsOn": [
		"[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
	  ],
	  "properties": {
		"description": "CTERA data connector with template version 1.0.0",
		"mainTemplate": {
		  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		  "contentVersion": "[variables('dataConnectorVersion1')]",
		  "parameters": {},
		  "variables": {},
		  "resources": [
			{
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2022-10-01",
			  "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
			  "location": "[parameters('workspace-location')]",
			  "kind": "GenericUI",
			  "properties": {
				"connectorUiConfig": {
				  "id": "[variables('_uiConfigId1')]",
				  "title": "CTERA Edge Filer",
				  "publisher": "CTERA",
				  "descriptionMarkdown": "The [CTERA](https://www.ctera.com/) connector allows you to easily connect your CTERA Edge Filer logs with Microsoft Sentinel, providing insight into file system activities and security events.",
				  "additionalRequirementBanner": "None",
				  "graphQueries": [
					{
					  "metricName": "Total events received",
					  "legend": "CTERA",
					  "baseQuery": "CTERA"
					}
				  ],
				  "sampleQueries": [
					{
					  "description": "Last 1000 generated events",
					  "query": "Syslog | top 1000 by TimeGenerated"
					},
					{
					  "description": "All events by facility except for cron",
					  "query": "Syslog | summarize count() by Facility | where Facility != 'cron'"
					}
				  ],
				  "connectivityCriterias": [
					{
					  "type": "IsConnectedQuery",
					  "value": [
						"Syslog | where TimeGenerated > ago(3d) | take 1 | project IsConnected = true"
					  ]
					}
				  ],
				  "dataTypes": [
					{
					  "name": "Syslog",
					  "lastDataReceivedQuery": "Syslog | summarize Time = max(TimeGenerated) | where isnotempty(Time)"
					}
				  ],
				  "availability": {
					"status": 1,
					"isPreview": false
				  },
				  "permissions": {
					"resourceProvider": [
					  {
						"provider": "Microsoft.OperationalInsights/workspaces",
						"permissionsDisplayText": "write permission is required.",
						"providerDisplayName": "Workspace",
						"scope": "Workspace",
						"requiredPermissions": {
						  "write": true,
						  "delete": true
						}
					  }
					]
				  },
				  "customers": [
					{
					  "name": "CTERA Edge Filers",
					  "description": "must be configured to export events via Syslog"
					}
				  ],
				  "instructionSteps": [
					{
					  "description": "Install the agent on a different machine from the one generating the logs. Syslog logs are collected only from **Linux** agents.",
					  "instructions": [
						{
						  "parameters": {
							"title": "Choose where to install the agent:",
							"instructionSteps": [
							  {
								"title": "Install agent on Azure Linux Virtual Machine",
								"description": "Select the machine to install the agent on and click **Connect**.",
								"instructions": [
								  {
									"parameters": {
									  "linkType": "InstallAgentOnLinuxVirtualMachine"
									},
									"type": "InstallAgent"
								  }
								]
							  },
							  {
								"title": "Install agent on a non-Azure Linux Machine",
								"description": "Download and install the agent on the relevant machine.",
								"instructions": [
								  {
									"parameters": {
									  "linkType": "InstallAgentOnLinuxNonAzure"
									},
									"type": "InstallAgent"
								  }
								]
							  }
							]
						  },
						  "type": "InstructionStepsGroup"
						}
					  ],
					  "title": "1. Install and onboard the agent for Linux"
					},
					{
					  "description": "Configure your Linux machine to send CTERA event information to Microsoft Sentinel. Configure the facilities and severities as per the Syslog settings.",
					  "instructions": [
						{
						  "parameters": {
							"linkType": "OpenSyslogSettings"
						  },
						  "type": "InstallAgent"
						}
					  ],
					  "title": "2. Configure the logs to be collected"
					},
					{
					  "description": "Refer to the CTERA documentation to configure CTERA Edge Filers to forward syslog events. Use the IP address or hostname of the Linux device running the Azure Monitor Agent.",
					  "title": "3. Configure CTERA Edge Filer settings"
					}
				  ]
				}
			  }
			},
			{
			  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-10-01",
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
			  "properties": {
				"parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
				"contentId": "[variables('_dataConnectorContentId1')]",
				"kind": "DataConnector",
				"version": "[variables('dataConnectorVersion1')]",
				"source": {
				  "kind": "Solution",
				  "name": "CTERA",
				  "sourceId": "[variables('_solutionId')]"
				},
				"author": {
				  "name": "CTERA",
				  "email": "[variables('_email')]"
				},
				"support": {
				  "name": "CTERA",
				  "tier": "Partner",
				  "link": "https://github.com/ctera-labs/Azure-Sentinel"
				}
			  }
			}
		  ]
		},
		"packageKind": "Solution",
		"packageVersion": "[variables('_solutionVersion')]",
		"packageName": "[variables('_solutionName')]",
		"packageId": "[variables('_solutionId')]",
		"contentSchemaVersion": "3.0.0",
		"contentId": "[variables('_dataConnectorContentId1')]",
		"contentKind": "DataConnector",
		"displayName": "CTERA Edge Filer",
		"contentProductId": "[variables('_dataConnectorcontentProductId1')]",
		"id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_dataConnectorcontentProductId1'))]",
		"version": "[variables('dataConnectorVersion1')]"
	  }
	},
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
	  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
	  "dependsOn": [
		"[variables('_dataConnectorId1')]"
	  ],
	  "location": "[parameters('workspace-location')]",
	  "properties": {
		"parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
		"contentId": "[variables('_dataConnectorContentId1')]",
		"kind": "DataConnector",
		"version": "[variables('dataConnectorVersion1')]",
		"source": {
		  "kind": "Solution",
		  "name": "CTERA",
		  "sourceId": "[variables('_solutionId')]"
		},
		"author": {
		  "name": "CTERA",
		  "email": "[variables('_email')]"
		},
		"support": {
		  "name": "CTERA",
		  "tier": "Partner",
		  "link": "https://github.com/ctera-labs/Azure-Sentinel"
		}
	  }
	},
	{
	  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2022-10-01",
	  "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
	  "location": "[parameters('workspace-location')]",
	  "kind": "GenericUI",
	  "properties": {
		"connectorUiConfig": {
		  "title": "CTERA Edge Filer",
		  "publisher": "CTERA",
		  "descriptionMarkdown": "The [CTERA](https://www.ctera.com/) connector allows you to easily connect your CTERA Edge Filer logs with Microsoft Sentinel, providing insight into file system activities and security events.",
		  "graphQueries": [
			{
			  "metricName": "Total events received",
			  "legend": "CTERA",
			  "baseQuery": "CTERA"
			}
		  ],
		  "dataTypes": [
			{
			  "name": "Syslog",
			  "lastDataReceivedQuery": "Syslog | summarize Time = max(TimeGenerated) | where isnotempty(Time)"
			}
		  ],
		  "permissions": {
			"resourceProvider": [
			  {
				"provider": "Microsoft.OperationalInsights/workspaces",
				"permissionsDisplayText": "write permission is required.",
				"providerDisplayName": "Workspace",
				"scope": "Workspace",
				"requiredPermissions": {
				  "write": true,
				  "delete": true
				}
			  }
			]
		  },
		  "customers": [
			{
			  "name": "CTERA Edge Filers",
			  "description": "must be configured to export events via Syslog"
			}
		  ],
		  "instructionSteps": [
			{
			  "title": "1. Install and onboard the agent for Linux",
			  "description": "Install the agent on a different machine from the one generating the logs. Syslog logs are collected only from **Linux** agents.",
			  "instructions": [
				{
				  "parameters": {
					"title": "Choose where to install the agent:",
					"instructionSteps": [
					  {
						"title": "Install agent on Azure Linux Virtual Machine",
						"description": "Select the machine to install the agent on and click **Connect**.",
						"instructions": [
						  {
							"parameters": {
							  "linkType": "InstallAgentOnLinuxVirtualMachine"
							},
							"type": "InstallAgent"
						  }
						]
					  },
					  {
						"title": "Install agent on a non-Azure Linux Machine",
						"description": "Download and install the agent on the relevant machine.",
						"instructions": [
						  {
							"parameters": {
							  "linkType": "InstallAgentOnLinuxNonAzure"
							},
							"type": "InstallAgent"
						  }
						]
					  }
					]
				  },
				  "type": "InstructionStepsGroup"
				}
			  ]
			},
			{
			  "title": "2. Configure the logs to be collected",
			  "description": "Configure your Linux machine to send CTERA event information to Microsoft Sentinel. Configure the facilities and severities as per the Syslog settings.",
			  "instructions": [
				{
				  "parameters": {
					"linkType": "OpenSyslogSettings"
				  },
				  "type": "InstallAgent"
				}
			  ]
			},
			{
			  "title": "3. Configure CTERA Edge Filer settings",
			  "description": "Refer to the CTERA documentation to configure CTERA Edge Filers to forward syslog events. Use the IP address or hostname of the Linux device running the Azure Monitor Agent."
			}
		  ]
		}
	  }
	},
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Ransom Protect Detected a Ransomware Attack Analytics Rule with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2022-01-01",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule monitors the CTERA platform to detect potential ransomware attacks detected by the CTERA Ransom Protect AI engine. Once detected, it exposes information including Virtual portal, Edge Filer, IP, User, Incident Type, Start and end time.",
                "displayName": "Ransom Protect Detected a Ransomware Attack",
                "enabled": false,
                "query": "Syslog\n| where SyslogMessage contains \"[com.ctera.db.jpa.log.RansomLogEntityListener] - Ransomware incident detected\"\n| extend \nPortal = extract(\"portal:(\\\\w+)\", 1, SyslogMessage),\nEdgeFiler = extract(\"Edge Filer:(\\\\w+-\\\\d+)\", 1, SyslogMessage),\nIP = extract(\"\\\\(IP:([0-9.]+)\\\\)\", 1, SyslogMessage),\nUser = extract(\"user:(\\\\w+)\", 1, SyslogMessage),\nIncidentType = extract(\"Incident type:(\\\\w+)\", 1, SyslogMessage),\nStartTime = extract(\"started at '([^]+)'\", 1, SyslogMessage),\nEndTime = extract(\"ended at '([^]+)'\", 1, SyslogMessage)\n| project TimeGenerated, Portal, EdgeFiler, IP, User, IncidentType, StartTime, EndTime",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT5H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "datatypes": [
                      "Syslog"
                    ],
                    "connectorId": "CTERA"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1486"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "EdgeFiler"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "EdgeFiler": "EdgeFiler"
                },
                "alertDetailsOverride": {
                  "alertnameFormat": "CTERA Ransom Protect Detected a Ransomware Attack.",
                  "alertDescriptionFormat": "CTERA Ransom Protect Detected a Ransomware Attack at {{TimeGenerated}}."
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "enabled": false,
                    "matchingMethod": "AllEntities",
                    "lookbackDuration": "PT5H"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "CTERA Analytics Rule",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "CTERA",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTERA",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "CTERA",
                  "tier": "Partner",
                  "link": "https://github.com/ctera-labs/Azure-Sentinel"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Ransom Protect Detected a Ransomware Attack",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_analyticRulecontentProductId1'))]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
	  "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
	  "location": "[parameters('workspace-location')]",
	  "dependsOn": [
		"[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
	  ],
	  "properties": {
		"description": "Detects malicious users blocked by CTERA Ransom Protect AI engine with template version 1.0.0",
		"mainTemplate": {
		  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		  "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
		  "parameters": {},
		  "variables": {},
		  "resources": [
			{
			  "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
			  "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
			  "apiVersion": "2022-01-01",
			  "kind": "Scheduled",
			  "location": "[parameters('workspace-location')]",
			  "properties": {
				"description": "This analytics rule detects malicious users blocked by CTERA Ransom Protect AI engine. It includes information like Portal, Edge Filer, IP, User, and Blocked Time.",
				"displayName": "Ransom Protect User Blocked",
				"enabled": false,
				"query": "Syslog\n| where SyslogMessage contains \"[com.ctera.db.jpa.log.RansomLogEntityListener] - Ransom Protect mechanism blocked\"\n| extend \nPortal = extract(\"portal:(\\\\w+)\", 1, SyslogMessage),\nEdgeFiler = extract(\"Edge Filer:(\\\\w+-\\\\d+)\", 1, SyslogMessage),\nIP = extract(\"IP:([0-9.]+)\", 1, SyslogMessage),\nUser = extract(\"user:(\\\\w+)\", 1, SyslogMessage),\nBlockedTime = extract(\"at ([^ ]+)\", 1, SyslogMessage)\n| project TimeGenerated, Portal, EdgeFiler, IP, User, BlockedTime",
				"queryFrequency": "PT5M",
				"queryPeriod": "PT5M",
				"severity": "High",
				"suppressionDuration": "PT5H",
				"suppressionEnabled": false,
				"triggerOperator": "GreaterThan",
				"triggerThreshold": 0,
				"status": "Available",
				"requiredDataConnectors": [
				  {
					"datatypes": [
					  "Syslog"
					],
					"connectorId": "CTERA"
				  }
				],
				"tactics": [
				  "Impact"
				],
				"techniques": [
				  "T1486"
				],
				"entityMappings": [
				  {
					"entityType": "Account",
					"fieldMappings": [
					  {
						"identifier": "FullName",
						"columnName": "User"
					  }
					]
				  },
				  {
					"entityType": "IP",
					"fieldMappings": [
					  {
						"identifier": "Address",
						"columnName": "IP"
					  }
					]
				  }
				],
				"eventGroupingSettings": {
				  "aggregationKind": "SingleAlert"
				},
				"customDetails": {
				  "EdgeFiler": "EdgeFiler"
				},
				"alertDetailsOverride": {
				  "alertnameFormat": "CTERA Ransom Protect User Blocked",
				  "alertDescriptionFormat": "CTERA Ransom Protect blocked a malicious user at {{TimeGenerated}}."
				},
				"incidentConfiguration": {
				  "createIncident": true,
				  "groupingConfiguration": {
					"reopenClosedIncident": false,
					"enabled": false,
					"matchingMethod": "AllEntities",
					"lookbackDuration": "PT5H"
				  }
				}
			  }
			},
			{
			  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
			  "properties": {
				"description": "CTERA Analytics Rule",
				"parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
				"contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
				"kind": "AnalyticsRule",
				"version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
				"source": {
				  "kind": "Solution",
				  "name": "CTERA",
				  "sourceId": "[variables('_solutionId')]"
				},
				"author": {
				  "name": "CTERA",
				  "email": "[variables('_email')]"
				},
				"support": {
				  "name": "CTERA",
				  "tier": "Partner",
				  "link": "https://github.com/ctera-labs/Azure-Sentinel"
				}
			  }
			}
		  ]
		},
		"packageKind": "Solution",
		"packageVersion": "[variables('_solutionVersion')]",
		"packageName": "[variables('_solutionName')]",
		"packageId": "[variables('_solutionId')]",
		"contentSchemaVersion": "3.0.0",
		"contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
		"contentKind": "AnalyticsRule",
		"displayName": "Ransom Protect User Blocked",
		"contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_analyticRulecontentProductId2'))]",
		"version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
	  }
	},
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
	  "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
	  "location": "[parameters('workspace-location')]",
	  "dependsOn": [
		"[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
	  ],
	  "properties": {
		"description": "This query detects access denied events generated by the CTERA Edge Filer with template version 1.0.0",
		"mainTemplate": {
		  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		  "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
		  "parameters": {},
		  "variables": {},
		  "resources": [
			{
			  "type": "Microsoft.SecurityInsights/HuntingQueryTemplates",
			  "name": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
			  "apiVersion": "2022-01-01",
			  "location": "[parameters('workspace-location')]",
			  "properties": {
				"description": "This query detects access denied events generated by the CTERA Edge Filer.",
				"displayName": "CTERA Mass Access Denied Detection",
				"enabled": false,
				"query": "Syslog\n| where ProcessName == 'gw-audit'\n| extend\nTenantName = extract(\"\\\"vportal\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nUserName = extract(\"user=([^|]*)\", 1, SyslogMessage),\nOperation = extract(\"op=([^|]*)\", 1, SyslogMessage),\nEdgeFiler = extract(\"\\\"client\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nRootPath = extract(\"rootPath=([^|]*)\", 1, SyslogMessage),\nShare = extract(\"share=([^|]*)\", 1, SyslogMessage),\nLocalPath = extract(\"path=([^|]*)\", 1, SyslogMessage),\nTimestamp = todatetime(extract(\"\\\"@timestamp\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage))\n| where Operation in ('OpenDenied', 'createDenied', 'OpenDenied', 'setsd', 'AclDenied', 'chown', 'AclDenied', 'deleteDenied')\n| summarize Count = count() by UserName, bin(Timestamp, 2m)\n| where Count > 10",
				"requiredDataConnectors": [
				  {
					"datatypes": [
					  "Syslog"
					],
					"connectorId": "CTERA"
				  }
				],
				"tactics": [
				  "Defense Evasion"
				],
				"techniques": [
				  "T1562"
				],
				"entityMappings": [
				  {
					"entityType": "Account",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "UserName"
					  }
					]
				  },
				  {
					"entityType": "IP",
					"fieldMappings": [
					  {
						"identifier": "Address",
						"columnName": "Timestamp"
					  }
					]
				  },
				  {
					"entityType": "File",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "Timestamp"
					  }
					]
				  }
				]
			  }
			},
			{
			  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryObject1').huntingQueryId1,'/'))))]",
			  "properties": {
				"description": "CTERA Hunting Query",
				"parentId": "[variables('huntingQueryObject1').huntingQueryId1]",
				"contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
				"kind": "HuntingQuery",
				"version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
				"source": {
				  "kind": "Solution",
				  "name": "CTERA",
				  "sourceId": "[variables('_solutionId')]"
				},
				"author": {
				  "name": "CTERA",
				  "email": "[variables('_email')]"
				},
				"support": {
				  "name": "CTERA",
				  "tier": "Partner",
				  "link": "https://github.com/ctera-labs/Azure-Sentinel"
				}
			  }
			}
		  ]
		},
		"packageKind": "Solution",
		"packageVersion": "[variables('_solutionVersion')]",
		"packageName": "[variables('_solutionName')]",
		"packageId": "[variables('_solutionId')]",
		"contentSchemaVersion": "3.0.0",
		"contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
		"contentKind": "HuntingQuery",
		"displayName": "CTERA Mass Access Denied Detection",
		"contentProductId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
		"id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_huntingQuerycontentId1'))]",
		"version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
	  }
	},
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
	  "name": "[variables('huntingQueryObject2').huntingQueryTemplateSpecName2]",
	  "location": "[parameters('workspace-location')]",
	  "dependsOn": [
		"[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
	  ],
	  "properties": {
		"description": "This query detects file deletions generated by the CTERA Edge Filer with template version 1.0.0",
		"mainTemplate": {
		  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		  "contentVersion": "[variables('huntingQueryObject2').huntingQueryVersion2]",
		  "parameters": {},
		  "variables": {},
		  "resources": [
			{
			  "type": "Microsoft.SecurityInsights/HuntingQueryTemplates",
			  "name": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
			  "apiVersion": "2022-01-01",
			  "location": "[parameters('workspace-location')]",
			  "properties": {
				"description": "This query detects file deletions generated by the CTERA Edge Filer.",
				"displayName": "CTERA Mass File Deletions Detection",
                "category": "Hunting Queries",
				"enabled": false,
				"query": "Syslog\n| where ProcessName == 'gw-audit'\n| extend\nTenantName = extract(\"\\\"vportal\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nUserName = extract(\"user=([^|]*)\", 1, SyslogMessage),\nPermission = extract(\"op=([^|]*)\", 1, SyslogMessage),\nEdgeFiler = extract(\"\\\"client\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nRootPath = extract(\"rootPath=([^|]*)\", 1, SyslogMessage),\nShare = extract(\"share=([^|]*)\", 1, SyslogMessage),\nLocalPath = extract(\"path=([^|]*)\", 1, SyslogMessage),\nTimestamp = todatetime(extract(\"\\\"@timestamp\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage))\n| where Permission == 'delete'\n| summarize Count = count() by UserName, bin(Timestamp, 2m)\n| where Count > 10",
				"requiredDataConnectors": [
				  {
					"datatypes": [
					  "Syslog"
					],
					"connectorId": "CTERA"
				  }
				],
				"tactics": [
				  "Impact"
				],
				"techniques": [
				  "T1485"
				],
				"entityMappings": [
				  {
					"entityType": "Account",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "UserName"
					  }
					]
				  },
				  {
					"entityType": "IP",
					"fieldMappings": [
					  {
						"identifier": "Address",
						"columnName": "Timestamp"
					  }
					]
				  },
				  {
					"entityType": "File",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "Timestamp"
					  }
					]
				  }
				]
			  }
			},
			{
			  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryObject2').huntingQueryId2,'/'))))]",
			  "properties": {
				"description": "CTERA Hunting Query 2",
				"parentId": "[variables('huntingQueryObject2').huntingQueryId2]",
				"contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
				"kind": "HuntingQuery",
				"version": "[variables('huntingQueryObject2').huntingQueryVersion2]",
				"source": {
				  "kind": "Solution",
				  "name": "CTERA",
				  "sourceId": "[variables('_solutionId')]"
				},
				"author": {
				  "name": "CTERA",
				  "email": "[variables('_email')]"
				},
				"support": {
				  "name": "CTERA",
				  "tier": "Partner",
				  "link": "https://github.com/ctera-labs/Azure-Sentinel"
				}
			  }
			}
		  ]
		},
		"packageKind": "Solution",
		"packageVersion": "[variables('_solutionVersion')]",
		"packageName": "[variables('_solutionName')]",
		"packageId": "[variables('_solutionId')]",
		"contentSchemaVersion": "3.0.0",
		"contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
		"contentKind": "HuntingQuery",
		"displayName": "CTERA Mass File Deletions Detection",
		"contentProductId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_huntingQuerycontentId2'))]",
		"version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
	  }
	},
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2022-10-01",
	  "name": "[variables('huntingQueryObject3').huntingQueryTemplateSpecName3]",
	  "location": "[parameters('workspace-location')]",
	  "dependsOn": [
		"[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
	  ],
	  "properties": {
		"description": "This query detects permission changes generated by the CTERA Edge Filer with template version 1.0.0",
		"mainTemplate": {
		  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
		  "contentVersion": "[variables('huntingQueryObject3').huntingQueryVersion3]",
		  "parameters": {},
		  "variables": {},
		  "resources": [
			{
			  "type": "Microsoft.SecurityInsights/HuntingQueryTemplates",
			  "name": "[variables('huntingQueryObject3')._huntingQueryContentId3]",
			  "apiVersion": "2022-01-01",
			  "location": "[parameters('workspace-location')]",
			  "properties": {
				"description": "This query detects permission changes generated by the CTERA Edge Filer.",
				"displayName": "CTERA Mass Permission Change Detection",
				"enabled": false,
				"query": "Syslog\n| where ProcessName == 'gw-audit'\n| extend\nTenantName = extract(\"\\\"vportal\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nUserName = extract(\"user=([^|]*)\", 1, SyslogMessage),\nOperation = extract(\"op=([^|]*)\", 1, SyslogMessage),\nEdgeFiler = extract(\"\\\"client\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage),\nRootPath = extract(\"rootPath=([^|]*)\", 1, SyslogMessage),\nShare = extract(\"share=([^|]*)\", 1, SyslogMessage),\nLocalPath = extract(\"path=([^|]*)\", 1, SyslogMessage),\nTimestamp = todatetime(extract(\"\\\"@timestamp\\\":\\\"([^\\\"]*)\\\"\", 1, SyslogMessage))\n| where Operation in ('ACLAdded', 'ACLDeleted', 'ACLProtectionAdded', 'ACLProtectionDeleted', 'ACEChanged', 'setdacl')\n| summarize Count = count() by UserName, bin(Timestamp, 2m)\n| where Count > 10",
				"requiredDataConnectors": [
				  {
					"datatypes": [
					  "Syslog"
					],
					"connectorId": "CTERA"
				  }
				],
				"tactics": [
				  "Privilege Escalation"
				],
				"techniques": [
				  "T1068"
				],
				"entityMappings": [
				  {
					"entityType": "Account",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "UserName"
					  }
					]
				  },
				  {
					"entityType": "IP",
					"fieldMappings": [
					  {
						"identifier": "Address",
						"columnName": "Timestamp"
					  }
					]
				  },
				  {
					"entityType": "File",
					"fieldMappings": [
					  {
						"identifier": "Name",
						"columnName": "Timestamp"
					  }
					]
				  }
				]
			  }
			},
			{
			  "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-10-01",
			  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryObject3').huntingQueryId3,'/'))))]",
			  "properties": {
				"description": "CTERA Hunting Query3",
				"parentId": "[variables('huntingQueryObject3').huntingQueryId3]",
				"contentId": "[variables('huntingQueryObject3')._huntingQueryContentId3]",
				"kind": "HuntingQuery",
				"version": "[variables('huntingQueryObject3').huntingQueryVersion3]",
				"source": {
				  "kind": "Solution",
				  "name": "CTERA",
				  "sourceId": "[variables('_solutionId')]"
				},
				"author": {
				  "name": "CTERA",
				  "email": "[variables('_email')]"
				},
				"support": {
				  "name": "CTERA",
				  "tier": "Partner",
				  "link": "https://github.com/ctera-labs/Azure-Sentinel"
				}
			  }
			}
		  ]
		},
		"packageKind": "Solution",
		"packageVersion": "[variables('_solutionVersion')]",
		"packageName": "[variables('_solutionName')]",
		"packageId": "[variables('_solutionId')]",
		"contentSchemaVersion": "3.0.0",
		"contentId": "[variables('huntingQueryObject3')._huntingQueryContentId3]",
		"contentKind": "HuntingQuery",
		"displayName": "CTERA Mass Permission Change Detection",
		"contentProductId": "[variables('huntingQueryObject3')._huntingQueryContentId3]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_huntingQueryContentId3'))]",
		"version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
	  }
	},
	{
	  "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2022-10-01",
	  "location": "[parameters('workspace-location')]",
	  "properties": {
		"version": "3.0.0",
		"kind": "Solution",
		"contentSchemaVersion": "3.0.0",
		"displayName": "CTERA",
		"publisherDisplayName": "CTERA Networks",
		"descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/CTERA/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.ctera.com\">CTERA</a> solution for Microsoft Sentinel allows you to analyze events from CTERA Edge Filers and Portal. It includes analytics rules to automatically generate Incidents when ransomware or abnormal behavior is detected and perform appropriate entity mapping.</p>\n<p>This solution is dependent on the Syslog solution containing the Syslog via AMA connector to collect the logs. The Syslog solution will be installed as part of this solution installation.</p>\n<p><strong>NOTE</strong>: Microsoft recommends installation of Syslog via AMA Connector. Legacy connector uses the Log Analytics agent which is about to be deprecated by <strong>Aug 31, 2024</strong>. Using MMA and AMA on the same machine can cause log duplication and extra ingestion costs. <a href=\"https://learn.microsoft.com/en-us/azure/sentinel/ama-migrate\">more details</a>.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Analytic Rules:</strong> 2, <strong>Hunting Queries:</strong> 3</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
		"contentKind": "Solution",
		"contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[resourceId('Microsoft.OperationalInsights/workspaces/providers/contentTemplates', variables('_solutioncontentProductId'))]",
		"icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/CTERA_Networks_logo.svg\" width=\"75px\" height=\"75px\">",
		"contentId": "[variables('_solutionId')]",
		"parentId": "[variables('_solutionId')]",
		"source": {
		  "kind": "Solution",
		  "name": "CTERA",
		  "sourceId": "[variables('_solutionId')]"
		},
		"author": {
		  "name": "CTERA Networks",
		  "email": "support@ctera.com"
		},
		"support": {
		  "name": "CTERA Networks",
		  "tier": "Partner",
		  "link": "https://www.ctera.com/support"
		},
		"dependencies": {
		  "criteria": [
			{
			  "kind": "AnalyticsRule",
			  "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
			  "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
			},
			{
			  "kind": "AnalyticsRule",
			  "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
			  "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
			},
			{
			  "kind": "HuntingQuery",
			  "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
			  "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
			},
			{
			  "kind": "HuntingQuery",
			  "contentId": "[variables('huntingQueryObject2')._huntingQuerycontentId2]",
			  "version": "[variables('huntingQueryObject2').huntingQueryVersion2]"
			},
			{
			  "kind": "HuntingQuery",
			  "contentId": "[variables('huntingQueryObject3')._huntingQueryContentId3]",
			  "version": "[variables('huntingQueryObject3').huntingQueryVersion3]"
			},
			{
			  "kind": "DataConnector",
			  "contentId": "[variables('_dataConnectorContentId1')]",
			  "version": "[variables('dataConnectorVersion1')]"
			},
			{
			  "kind": "Solution",
			  "contentId": "azuresentinel.azure-sentinel-solution-syslog"
			}
		  ]
		},
		"firstPublishDate": "[parameters('_firstPublishDate')]",
		"lastPublishDate": "[parameters('_lastPublishDate')]",
		"providers": [
		  "CTERA Networks"
		],
		"categories": {
		  "domains": [
			"Storage"
		  ]
		}
	  },
	  "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
	}
  ],
	"outputs": {}
}