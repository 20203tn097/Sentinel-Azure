{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "CTM360 - monitor@ctm360.com",
    "comments": "Solution template for CTM360"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "ctm360123456.ctm360_for_sentinel",
    "_solutionId": "[variables('solutionId')]",
    "email": "monitor@ctm360.com",
    "_email": "[variables('email')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "uiConfigId1": "CBSPollingID",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CBSPollingID",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "uiConfigId2": "HVPollingID",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "HVPollingID",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2')))]",
    "dataConnectorVersion2": "1.0.0",
    "uiConfigId3": "CBSPollingID1t",
    "_uiConfigId3": "[variables('uiConfigId3')]",
    "dataConnectorContentId3": "CBSPollingID1t",
    "_dataConnectorContentId3": "[variables('dataConnectorContentId3')]",
    "dataConnectorId3": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId3'))]",
    "_dataConnectorId3": "[variables('dataConnectorId3')]",
    "dataConnectorTemplateSpecName3": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId3')))]",
    "dataConnectorVersion3": "1.0.0",
    "uiConfigId4": "HVPollingID1t",
    "_uiConfigId4": "[variables('uiConfigId4')]",
    "dataConnectorContentId4": "HVPollingID1t",
    "_dataConnectorContentId4": "[variables('dataConnectorContentId4')]",
    "dataConnectorId4": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId4'))]",
    "_dataConnectorId4": "[variables('dataConnectorId4')]",
    "dataConnectorTemplateSpecName4": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId4')))]",
    "dataConnectorVersion4": "1.0.0"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "CTM360 data connector with template",
        "displayName": "CTM360 template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CTM360 data connector with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "APIPolling",
              "properties": {
                "connectorUiConfig": {
                  "title": "CBS Intergration - (Polling CCP)",
                  "id": "[variables('_uiConfigId1')]",
                  "publisher": "CTM360",
                  "descriptionMarkdown": "CBS Data Connector",
                  "graphQueriesTableName": "CBSLogPolling_1_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "CBS log events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "SentinelKindsV2",
                      "value": [
                        "APIPolling"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true,
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "CBS API Key",
                        "description": "Through the API integration, you have the capability to retrieve all the issues related to your CBS organizations via a RESTful interface."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Connecting the CBS Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your CBS Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
                      "instructions": [
                        {
                          "parameters": {
                            "enable": "false"
                          },
                          "type": "APIKey"
                        }
                      ],
                      "title": "Establish a connection between the XYZ Log and Microsoft Sentinel."
                    }
                  ]
                },
                "pollingConfig": {
                  "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "api-key",
                    "IsAPIKeyInPostPayload": false
                  },
                  "request": {
                    "apiEndpoint": "https://cbs.ctm360.com/api/v2/incidents",
                    "rateLimitQPS": 2,
                    "httpMethod": "Get",
                    "queryTimeFormat": "dd-MM-yyyy HH:mm",
                    "retryCount": 3,
                    "queryWindowInMin": 10,
                    "timeoutInSeconds": 120,
                    "queryParameters": {
                      "date_from": "{_QueryWindowStartTime}",
                      "date_to": "{_QueryWindowEndTime}",
                      "FROM_MIRCROSOFT_SENTINEL": true
                    },
                    "headers": {
                      "Accept": "application/json"
                    }
                  },
                  "response": {
                    "eventsJsonPaths": [
                      "$.incident_list[*]"
                    ]
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "CTM360",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTM360",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyber Threat Management 360",
                  "email": "monitor@ctm360.com",
                  "tier": "Partner",
                  "link": "https://www.ctm360.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "CTM360",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "CTM360",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyber Threat Management 360",
          "email": "monitor@ctm360.com",
          "tier": "Partner",
          "link": "https://www.ctm360.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "APIPolling",
      "properties": {
        "connectorUiConfig": {
          "title": "CBS Intergration - (Polling CCP)",
          "id": "[variables('_uiConfigId1')]",
          "publisher": "CTM360",
          "descriptionMarkdown": "CBS Data Connector",
          "graphQueriesTableName": "CBSLogPolling_1_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "CBS log events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "SentinelKindsV2",
              "value": [
                "APIPolling"
              ]
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true,
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "CBS API Key",
                "description": "Through the API integration, you have the capability to retrieve all the issues related to your CBS organizations via a RESTful interface."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Connecting the CBS Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your CBS Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
              "instructions": [
                {
                  "parameters": {
                    "enable": "false"
                  },
                  "type": "APIKey"
                }
              ],
              "title": "Establish a connection between the XYZ Log and Microsoft Sentinel."
            }
          ]
        },
        "pollingConfig": {
          "auth": {
            "authType": "APIKey",
            "APIKeyName": "api-key",
            "IsAPIKeyInPostPayload": false
          },
          "request": {
            "apiEndpoint": "https://cbs.ctm360.com/api/v2/incidents",
            "rateLimitQPS": 2,
            "httpMethod": "Get",
            "queryTimeFormat": "dd-MM-yyyy HH:mm",
            "retryCount": 3,
            "queryWindowInMin": 10,
            "timeoutInSeconds": 120,
            "queryParameters": {
              "date_from": "{_QueryWindowStartTime}",
              "date_to": "{_QueryWindowEndTime}",
              "FROM_MIRCROSOFT_SENTINEL": true
            },
            "headers": {
              "Accept": "application/json"
            }
          },
          "response": {
            "eventsJsonPaths": [
              "$.incident_list[*]"
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "CTM360 data connector with template",
        "displayName": "CTM360 template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName2'),'/',variables('dataConnectorVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CTM360 data connector with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "APIPolling",
              "properties": {
                "connectorUiConfig": {
                  "title": "HackerView Intergration -  (Polling CCP)",
                  "id": "[variables('_uiConfigId2')]",
                  "publisher": "CTM360",
                  "descriptionMarkdown": "HackerView Data Connector",
                  "graphQueriesTableName": "HVLogPolling_1_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "HackerView log events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "SentinelKindsV2",
                      "value": [
                        "APIPolling"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true,
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "HACKERVIEW API Key",
                        "description": "Through the API integration, you have the capability to retrieve all the issues related to your HackerView organizations via a RESTful interface."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Connecting the HackerView Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your HackerView Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
                      "instructions": [
                        {
                          "parameters": {
                            "enable": "false"
                          },
                          "type": "APIKey"
                        }
                      ],
                      "title": "Establish a connection between the HackerView Log and Microsoft Sentinel."
                    }
                  ]
                },
                "pollingConfig": {
                  "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "api-key",
                    "IsAPIKeyInPostPayload": false
                  },
                  "request": {
                    "apiEndpoint": "https://hackerview.ctm360.com/api/v2/issues",
                    "rateLimitQPS": 2,
                    "httpMethod": "Get",
                    "queryTimeFormat": "dd-MM-yyyy HH:mm",
                    "retryCount": 3,
                    "queryWindowInMin": 10,
                    "timeoutInSeconds": 120,
                    "queryParameters": {
                      "first_seen": "{_QueryWindowStartTime}",
                      "FROM_MIRCROSOFT_SENTINEL": true
                    },
                    "headers": {
                      "Accept": "application/json"
                    }
                  },
                  "response": {
                    "eventsJsonPaths": [
                      "$.issues[*]"
                    ]
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "CTM360",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTM360",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyber Threat Management 360",
                  "email": "monitor@ctm360.com",
                  "tier": "Partner",
                  "link": "https://www.ctm360.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "CTM360",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "CTM360",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyber Threat Management 360",
          "email": "monitor@ctm360.com",
          "tier": "Partner",
          "link": "https://www.ctm360.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "APIPolling",
      "properties": {
        "connectorUiConfig": {
          "title": "HackerView Intergration -  (Polling CCP)",
          "id": "[variables('_uiConfigId2')]",
          "publisher": "CTM360",
          "descriptionMarkdown": "HackerView Data Connector",
          "graphQueriesTableName": "HVLogPolling_1_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "HackerView log events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "SentinelKindsV2",
              "value": [
                "APIPolling"
              ]
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true,
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "HACKERVIEW API Key",
                "description": "Through the API integration, you have the capability to retrieve all the issues related to your HackerView organizations via a RESTful interface."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Connecting the HackerView Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your HackerView Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
              "instructions": [
                {
                  "parameters": {
                    "enable": "false"
                  },
                  "type": "APIKey"
                }
              ],
              "title": "Establish a connection between the HackerView Log and Microsoft Sentinel."
            }
          ]
        },
        "pollingConfig": {
          "auth": {
            "authType": "APIKey",
            "APIKeyName": "api-key",
            "IsAPIKeyInPostPayload": false
          },
          "request": {
            "apiEndpoint": "https://hackerview.ctm360.com/api/v2/issues",
            "rateLimitQPS": 2,
            "httpMethod": "Get",
            "queryTimeFormat": "dd-MM-yyyy HH:mm",
            "retryCount": 3,
            "queryWindowInMin": 10,
            "timeoutInSeconds": 120,
            "queryParameters": {
              "first_seen": "{_QueryWindowStartTime}",
              "FROM_MIRCROSOFT_SENTINEL": true
            },
            "headers": {
              "Accept": "application/json"
            }
          },
          "response": {
            "eventsJsonPaths": [
              "$.issues[*]"
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "CTM360 data connector with template",
        "displayName": "CTM360 template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName3'),'/',variables('dataConnectorVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CTM360 data connector with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId3'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "APIPolling",
              "properties": {
                "connectorUiConfig": {
                  "title": "CBS Intergration - (1 Time Polling CCP)",
                  "id": "[variables('_uiConfigId3')]",
                  "publisher": "CTM360",
                  "descriptionMarkdown": "CBS Data Connector",
                  "graphQueriesTableName": "CBSLogPolling_1_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "CBS log events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "SentinelKindsV2",
                      "value": [
                        "APIPolling"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true,
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "CBS API Key",
                        "description": "Through the API integration, you have the capability to retrieve all the issues related to your CBS organizations via a RESTful interface.This process is set to run every 30 minutes. It is crucial to disable it promptly after inserting new data into the database. Failure to do so may result in data duplication, making it difficult to remove from the database."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Connecting the CBS Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your CBS Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
                      "instructions": [
                        {
                          "parameters": {
                            "enable": "true",
                            "userRequestPlaceHoldersInput": [
                              {
                                "displayText": "date_from  in format same like dd-MM-yyyy HH:mm",
                                "requestObjectKey": "queryParameters.date_from",
                                "placeHolderName": "{{PlaceHolder1}}",
                                "placeHolderValue": "01-01-1970 00:00"
                              },
                              {
                                "displayText": "date_to  in format same like dd-MM-yyyy HH:mm",
                                "requestObjectKey": "queryParameters.date_to",
                                "placeHolderName": "{{PlaceHolder2}}",
                                "placeHolderValue": "01-01-2023 00:00"
                              }
                            ]
                          },
                          "type": "APIKey"
                        }
                      ],
                      "title": "Establish a connection between the CBS Log and Microsoft Sentinel."
                    }
                  ]
                },
                "pollingConfig": {
                  "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "api-key",
                    "IsAPIKeyInPostPayload": false
                  },
                  "request": {
                    "apiEndpoint": "https://cbs.ctm360.com/api/v2/incidents",
                    "rateLimitQPS": 2,
                    "httpMethod": "Get",
                    "queryTimeFormat": "dd-MM-yyyy HH:mm",
                    "retryCount": 3,
                    "queryWindowInMin": 30,
                    "timeoutInSeconds": 120,
                    "queryParameters": {
                      "date_from": "'{{PlaceHolder1}}'",
                      "date_to": "'{{PlaceHolder2}}'",
                      "FROM_MIRCROSOFT_SENTINEL": true
                    },
                    "headers": {
                      "Accept": "application/json"
                    }
                  },
                  "response": {
                    "eventsJsonPaths": [
                      "$.incident_list[*]"
                    ]
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId3'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId3'))]",
                "contentId": "[variables('_dataConnectorContentId3')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "CTM360",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTM360",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyber Threat Management 360",
                  "email": "monitor@ctm360.com",
                  "tier": "Partner",
                  "link": "https://www.ctm360.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId3'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId3')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId3'))]",
        "contentId": "[variables('_dataConnectorContentId3')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion3')]",
        "source": {
          "kind": "Solution",
          "name": "CTM360",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "CTM360",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyber Threat Management 360",
          "email": "monitor@ctm360.com",
          "tier": "Partner",
          "link": "https://www.ctm360.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId3'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "APIPolling",
      "properties": {
        "connectorUiConfig": {
          "title": "CBS Intergration - (1 Time Polling CCP)",
          "id": "[variables('_uiConfigId3')]",
          "publisher": "CTM360",
          "descriptionMarkdown": "CBS Data Connector",
          "graphQueriesTableName": "CBSLogPolling_1_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "CBS log events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "SentinelKindsV2",
              "value": [
                "APIPolling"
              ]
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true,
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "CBS API Key",
                "description": "Through the API integration, you have the capability to retrieve all the issues related to your CBS organizations via a RESTful interface.This process is set to run every 30 minutes. It is crucial to disable it promptly after inserting new data into the database. Failure to do so may result in data duplication, making it difficult to remove from the database."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Connecting the CBS Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your CBS Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
              "instructions": [
                {
                  "parameters": {
                    "enable": "true",
                    "userRequestPlaceHoldersInput": [
                      {
                        "displayText": "date_from  in format same like dd-MM-yyyy HH:mm",
                        "requestObjectKey": "queryParameters.date_from",
                        "placeHolderName": "{{PlaceHolder1}}",
                        "placeHolderValue": "01-01-1970 00:00"
                      },
                      {
                        "displayText": "date_to  in format same like dd-MM-yyyy HH:mm",
                        "requestObjectKey": "queryParameters.date_to",
                        "placeHolderName": "{{PlaceHolder2}}",
                        "placeHolderValue": "01-01-2023 00:00"
                      }
                    ]
                  },
                  "type": "APIKey"
                }
              ],
              "title": "Establish a connection between the CBS Log and Microsoft Sentinel."
            }
          ]
        },
        "pollingConfig": {
          "auth": {
            "authType": "APIKey",
            "APIKeyName": "api-key",
            "IsAPIKeyInPostPayload": false
          },
          "request": {
            "apiEndpoint": "https://cbs.ctm360.com/api/v2/incidents",
            "rateLimitQPS": 2,
            "httpMethod": "Get",
            "queryTimeFormat": "dd-MM-yyyy HH:mm",
            "retryCount": 3,
            "queryWindowInMin": 30,
            "timeoutInSeconds": 120,
            "queryParameters": {
              "date_from": "'{{PlaceHolder1}}'",
              "date_to": "'{{PlaceHolder2}}'",
              "FROM_MIRCROSOFT_SENTINEL": true
            },
            "headers": {
              "Accept": "application/json"
            }
          },
          "response": {
            "eventsJsonPaths": [
              "$.incident_list[*]"
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "CTM360 data connector with template",
        "displayName": "CTM360 template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName4'),'/',variables('dataConnectorVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "CTM360 data connector with template version 1.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId4'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "APIPolling",
              "properties": {
                "connectorUiConfig": {
                  "title": "HackerView Intergration -  (1 Time Polling CCP)",
                  "id": "[variables('_uiConfigId4')]",
                  "publisher": "CTM360",
                  "descriptionMarkdown": "HackerView Data Connector",
                  "graphQueriesTableName": "HVLogPolling_1_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "HackerView log events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "SentinelKindsV2",
                      "value": [
                        "APIPolling"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true,
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "HACKERVIEW API Key",
                        "description": "Through the API integration, you have the capability to retrieve all the issues related to your HackerView organizations via a RESTful interface. This process is set to run every 30 minutes. It is crucial to disable it promptly after inserting new data into the database. Failure to do so may result in data duplication, making it difficult to remove from the database."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Connecting the HackerView Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your HackerView Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
                      "instructions": [
                        {
                          "parameters": {
                            "enable": "true",
                            "userRequestPlaceHoldersInput": [
                              {
                                "displayText": "first_seen  in format same like dd-MM-yyyy HH:mm ",
                                "requestObjectKey": "queryParameters.first_seen",
                                "placeHolderName": "{{PlaceHolder1}}",
                                "placeHolderValue": "10-11-2023 00:14"
                              }
                            ]
                          },
                          "type": "APIKey"
                        }
                      ],
                      "title": "Establish a connection between the HackerView Log and Microsoft Sentinel."
                    }
                  ]
                },
                "pollingConfig": {
                  "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "api-key",
                    "IsAPIKeyInPostPayload": false
                  },
                  "request": {
                    "apiEndpoint": "https://hackerview.ctm360.com/api/v2/issues",
                    "rateLimitQPS": 2,
                    "httpMethod": "Get",
                    "queryTimeFormat": "dd-MM-yyyy HH:mm",
                    "retryCount": 3,
                    "queryWindowInMin": 30,
                    "timeoutInSeconds": 120,
                    "queryParameters": {
                      "first_seen": "'{{PlaceHolder1}}'",
                      "FROM_MIRCROSOFT_SENTINEL": true
                    },
                    "headers": {
                      "Accept": "application/json"
                    }
                  },
                  "response": {
                    "eventsJsonPaths": [
                      "$.issues[*]"
                    ]
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId4'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId4'))]",
                "contentId": "[variables('_dataConnectorContentId4')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "CTM360",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "CTM360",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cyber Threat Management 360",
                  "email": "monitor@ctm360.com",
                  "tier": "Partner",
                  "link": "https://www.ctm360.com/"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId4'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId4')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId4'))]",
        "contentId": "[variables('_dataConnectorContentId4')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion4')]",
        "source": {
          "kind": "Solution",
          "name": "CTM360",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "CTM360",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyber Threat Management 360",
          "email": "monitor@ctm360.com",
          "tier": "Partner",
          "link": "https://www.ctm360.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId4'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "APIPolling",
      "properties": {
        "connectorUiConfig": {
          "title": "HackerView Intergration -  (1 Time Polling CCP)",
          "id": "[variables('_uiConfigId4')]",
          "publisher": "CTM360",
          "descriptionMarkdown": "HackerView Data Connector",
          "graphQueriesTableName": "HVLogPolling_1_CL",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "HackerView log events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "{{graphQueriesTableName}}\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "SentinelKindsV2",
              "value": [
                "APIPolling"
              ]
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true,
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "HACKERVIEW API Key",
                "description": "Through the API integration, you have the capability to retrieve all the issues related to your HackerView organizations via a RESTful interface. This process is set to run every 30 minutes. It is crucial to disable it promptly after inserting new data into the database. Failure to do so may result in data duplication, making it difficult to remove from the database."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Connecting the HackerView Log to Microsoft Sentinel enables seamless and secure data integration, allowing you to efficiently manage and analyze log information within the powerful capabilities of Microsoft Sentinel. This integration enhances your organization's ability to detect and respond to security threats, collect valuable insights, and streamline your overall cybersecurity operations. It provides a bridge between your HackerView Log and Microsoft Sentinel, ensuring that critical data is readily available for threat detection, incident response, and comprehensive security monitoring.",
              "instructions": [
                {
                  "parameters": {
                    "enable": "true",
                    "userRequestPlaceHoldersInput": [
                      {
                        "displayText": "first_seen  in format same like dd-MM-yyyy HH:mm ",
                        "requestObjectKey": "queryParameters.first_seen",
                        "placeHolderName": "{{PlaceHolder1}}",
                        "placeHolderValue": "10-11-2023 00:14"
                      }
                    ]
                  },
                  "type": "APIKey"
                }
              ],
              "title": "Establish a connection between the HackerView Log and Microsoft Sentinel."
            }
          ]
        },
        "pollingConfig": {
          "auth": {
            "authType": "APIKey",
            "APIKeyName": "api-key",
            "IsAPIKeyInPostPayload": false
          },
          "request": {
            "apiEndpoint": "https://hackerview.ctm360.com/api/v2/issues",
            "rateLimitQPS": 2,
            "httpMethod": "Get",
            "queryTimeFormat": "dd-MM-yyyy HH:mm",
            "retryCount": 3,
            "queryWindowInMin": 30,
            "timeoutInSeconds": 120,
            "queryParameters": {
              "first_seen": "'{{PlaceHolder1}}'",
              "FROM_MIRCROSOFT_SENTINEL": true
            },
            "headers": {
              "Accept": "application/json"
            }
          },
          "response": {
            "eventsJsonPaths": [
              "$.issues[*]"
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "1.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "CTM360",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "CTM360",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cyber Threat Management 360",
          "email": "monitor@ctm360.com",
          "tier": "Partner",
          "link": "https://www.ctm360.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId3')]",
              "version": "[variables('dataConnectorVersion3')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId4')]",
              "version": "[variables('dataConnectorVersion4')]"
            }
          ]
        },
        "firstPublishDate": "2023-10-23",
        "providers": [
          "CTM360"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence",
            "Security - Information Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
