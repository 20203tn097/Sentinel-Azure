{
  "id": "ImpervaWAFGateway",
  "title": "Imperva WAF Gateway",
  "publisher": "Imperva",
  "descriptionMarkdown": "The [Imperva](https://www.imperva.com) connector will allow you to quickly connect your Imperva WAF Gateway alerts to Azure Sentinel. This provides you additional insight into your organization's WAF traffic and improves your security operation capabilities.",
  "graphQueries": [
      {
          "metricName": "Total data received",
          "legend": "WAF_Alerts",
          "baseQuery": "CommonSecurityLog\n| where DeviceVendor == \"Imperva Inc.\"\n| where DeviceProduct == \"WAF Gateway\""
      }
  ],
  "sampleQueries": [
      {
          "description" : "Find all log events of high priority.",
          "query": "CommonSecurityLog\n| where LogSeverity == \"High\""
      },
      {
          "description": "Find all events that were blocked.",
          "query": "CommonSecurityLog\n| where DeviceAction == \"block\""
      },
      {
          "description": "Find all events that were SQL Injection alerts.",
          "query": "CommonSecurityLog\n| where Activity == \"sql-injection\""
      }
  ],
  "dataTypes": [
      {
          "name": "CommonSecurityLog (Imperva WAF Gateway)",
          "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceVendor == \"Imperva Inc.\"\n| where DeviceProduct == \"WAF Gateway\"\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
      }
  ],
  "connectivityCriterias": [
      {
          "type": "IsConnectedQuery",
          "value": [
              "CommonSecurityLog\n| where DeviceVendor == \"Imperva\"\n| where DeviceProduct == \"WAF Gateway\"\n| summarize LastLogReceived = max(TimeGenerated)\n| project IsConnected = LastLogReceived > ago(30d)"
          ]
      }
  ],
  "availability": {
      "status": 1
  },
  "permissions": {
      "resourceProvider": [
          {
              "provider": "Microsoft.OperationalInsights/workspaces",
              "permissionsDisplayText": "read and write permissions are required.",
              "providerDisplayName": "Workspace",
              "scope": "Workspace",
              "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
              }
          },
          {
              "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
              "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
              "providerDisplayName": "Keys",
              "scope": "Workspace",
              "requiredPermissions": {
                  "action": true
              }
          }
      ]
  },
  "instructionSteps": [
      {
          "title": "1. SecureSphere MX Configuration",
          "description": "This connector requires an Action Interface and Action Set to be created on the Imperva SecureSphere MX.  [Follow the steps](https://community.imperva.com/blogs/craig-burlingame1/2020/11/13/steps-for-enabling-imperva-waf-gateway-alert) to create the requirements.",
          "innerSteps": [
              {
                  "title": "1.1 Create the Action Interface",
                  "description": "Create a new Action Interface that contains the required parameters to send WAF alerts to Azure Sentinel."
              },
              {
                  "title": "1.2 Create the Action Set ",
                  "description": "Create a new Action Set that uses the Action Interface configured."
              }
          ]
      },
      {
          "title": "2. Apply the Action Set",
          "description": "Apply the Action Set to any Security Policies you wish to have alerts for sent to Azure Sentinel."
      },
      {
          "title": "3. Validate connection",
          "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n"
      }
  ]
}
